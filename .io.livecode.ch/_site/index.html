{% extends "base_livecode.html" %}

{% block title %}miniKanren, Live and Untagged: Quine Generation via Relational Interpreters (Programming Pearl){% endblock %}

{% block content %}
<ul>
<li>William E. Byrd</li>
<li>Eric Holk</li>
<li>Daniel P. Friedman</li>
</ul>

<div class="live norun hidden" id="appendixD">
(load "appendixD.scm")
</div>

<h2>Abstract</h2>

<p class="noindent" >We present relational interpreters for several subsets of Scheme,
written in the pure logic programming language miniKanren.
We demonstrate these interpreters running “backwards”—that
is, generating programs that evaluate to a specified value—and
show how the interpreters can trivially generate <span 
class="cmti-9">quines</span>
(programs that evaluate to themselves). We demonstrate how to
transform environment-passing interpreters written in Scheme
into relational interpreters written in miniKanren. We show how
constraint extensions to core miniKanren can be used to allow
shadowing of the interpreter’s primitive forms (using the
<span 
class="cmti-9">absent</span><!--l. 77--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math>
tree constraint), and to avoid having to tag expressions in the
languages being interpreted (using disequality constraints and
symbol/number type-constraints), simplifying the interpreters
and eliminating the need for parsers/unparsers.
</p><!--l. 82--><p class="indent" >We provide four appendices to make the code in the
paper completely self-contained. Three of these appendices
contain new code: the complete implementation of core
miniKanren extended with the new constraints; an extended
relational interpreter capable of running factorial and doing list
processing; and a simple pattern matcher that uses Dijkstra
guards. The other appendix presents our preferred version of
code that has been presented elsewhere: the miniKanren
relational arithmetic system used in the extended interpreter.
</p>

<h3 class="sectionHead"><span class="titlemark">1. </span> <a 
 id="x1-50001"></a>Introduction</h3>
<!--l. 4--><p class="noindent" >A <span 
class="cmti-9">quine </span>is a program that evaluates to itself
(<span class="cite"><a 
href="#XGEB79">Hofstadter</a></span> <span class="cite"><a 
href="#XGEB79">1979</a></span>; <span class="cite"><a 
href="#Xthe_quine_page">Thompson II</a></span>); the simplest Scheme quines
are self-evaluating literals, such as numbers and booleans. A
classic non-trivial quine (<span class="cite"><a 
href="#Xthe_quine_page">Thompson II</a></span>) is:

<div class="live norun" id="quinec">
(define quinec 
  '((lambda (x)
      (list x (list (quote quote) x)))
    (quote
      (lambda (x)
        (list x (list (quote quote) x))))))
</div>


<p class="noindent" >We can easily verify  that
<span 
class="cmti-9">quine</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>c</mi></math>
                                     evaluates to itself:
                                     </p>

<div class="live" id="verify-quinec" data-lib="quinec">
(equal? (eval quinec) quinec)
</div>

<p class="indent" >  For decades programmers have amused themselves by writing
                                     quines in countless programming languages. Some quines, such
                                     as those featured in the International Obfuscated C Code
                                     Contest (<span class="cite"><a 
href="#Xobfuscated_c">Broukhis et al.</a></span>), are intentionally baroque. Here we
                                     demonstrate a disciplined approach to the problem: we show
                                     how to translate a standard environment-passing interpreter
                                     written as a Scheme function into a relation in the pure logic
                                     programming language miniKanren (<span class="cite"><a 
href="#Xbyrdthesis">Byrd</a></span> <span class="cite"><a 
href="#Xbyrdthesis">2009</a></span>; <span class="cite"><a 
href="#Xreasoned">Friedman
                                     et al.</a></span> <span class="cite"><a 
href="#Xreasoned">2005</a></span>), then show how this relational interpreter
                                     can be used, without modification, to trivially generate
                                     quines.<span class="footnote-mark"><a 
href="quines2.html#fn1x0"><sup class="textsuperscript">1</sup></a></span><a 
 id="x1-5001f1"></a> 
                                     </p><!--l. 50--><p class="noindent" >We also show how to generate <span 
class="cmti-9">twines </span>(twin quines), which are
                                     distinct programs <span 
class="cmti-9">p </span>and <span 
class="cmti-9">q </span>that evaluate to each other,
                                     and <span 
class="cmti-9">thrines</span>, which are distinct programs <span 
class="cmti-9">p</span>, <span 
class="cmti-9">q</span>, and <span 
class="cmti-9">r </span>such
                                     that <span 
class="cmti-9">p </span>evaluates to <span 
class="cmti-9">q</span>, <span 
class="cmti-9">q </span>evaluates to <span 
class="cmti-9">r</span>, and <span 
class="cmti-9">r </span>evaluates to
                                     <span 
class="cmti-9">p</span>.
                                     </p><!--l. 75--><p class="indent" >  While generating quines is fun and interesting, our
                                     approach also illustrates advanced techniques of relational
                                     programming, such as translating functional programs
                                     into relational programs, and using constraints to avoid
                                     having to tag the expressions being interpreted. This last
                                     point is especially important, as tagging implies the need
                                     to write parsers and unparsers, and because tagging the
                                     application line of the interpreter greatly complicates the
                                     handling of <span 
class="cmbx-9">quote </span>and <span 
class="cmti-9">list</span>. Our use of constraints also has the
                                     important benefit of properly handling shadowing of the
                                     interpreter’s built-in primitives, such as <span 
class="cmti-9">list</span>, <span 
class="cmbx-9">quote</span>, and
                                     <span 
class="cmbx-9">lambda</span>.
                                     </p><!--l. 87--><p class="indent" >  Our approach requires adding several constraint operators to
                                     core miniKanren. We have previously presented disequality
                                     constraints in cKanren (<span class="cite"><a 
href="#XcKanren">Alvis et al.</a></span> <span class="cite"><a 
href="#XcKanren">2011</a></span>), a general constraint logic
                                     programming (<span class="cite"><a 
href="#Xapt03principles">Apt</a></span> <span class="cite"><a 
href="#Xapt03principles">2003</a></span>) framework inspired by miniKanren; the
                                     <span 
class="cmti-9">symbol</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>,
                                     <span 
class="cmti-9">number</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>,
                                     and <span 
class="cmti-9">absent</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                     constraints we introduce are also straightforward to implement
                                     in cKanren. However, we have found that core miniKanren
                                     augmented with these four constraints is sufficient for
                                     implementing a wide variety of interesting programs, including
                                     interpreters and inferencers. This extended miniKanren is
                                     conceptually simpler than cKanren, and its implementation is
                                     easier to understand and modify. Programmers needing to use
                                     domain-specific constraints, such as arithmetic over finite
                                     domains (CLP(FD)), will find that the techniques described
                                     here, up to and including quine generation, work equally well in
                                     cKanren.

</p><!--l. 103--><p class="indent" >Our paper makes the following contributions: </p>
<ul class="itemize1">
<li class="itemize">
<!--l. 105--><p class="indent" >We extend the miniKanren core language with four
constraint operators (section <a 
href="#x1-80002.2">2.2<!--tex4ht:ref: mknew --></a>): the disequality constraint
<!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math>;
type constraints <span 
class="cmti-9">symbol</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
and <span 
class="cmti-9">number</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>,
which are similar  in  spirit  to  Scheme’s  <span 
class="cmti-9">symbol?  </span>and
<span 
class="cmti-9">number? </span>predicates; and the tree constraint <span 
class="cmti-9">absent</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>,
which ensures  a  symbol  <span 
class="cmti-9">tag  </span>does  not  occur  inside  a
term <span 
class="cmti-9">t</span>. These  constraints  are  extremely  useful  when
writing logic programs, especially interpreters and type
inferencers.
</p></li>
<li class="itemize">
<!--l. 114--><p class="indent" >We describe  and  demonstrate  our  methodology  for
translating interpreters  from  Scheme  to  miniKanren
(section <a 
href="#x1-90003">3<!--tex4ht:ref: sec:interpreter --></a>). Our  methodology  is  equally  useful  for
translating type inferencers.
</p></li>
<li class="itemize">
<!--l. 117--><p class="indent" >We show how <!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math>,
<span 
class="cmti-9">symbol</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math>,
and <span 
class="cmti-9">number</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
can be used when writing an interpreter (or type inferencer)
to avoid having to tag expressions in the language being
interpreted, and how <span 
class="cmti-9">absent</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
can be used  to  allow  shadowing  of  primitive  forms
(section <a 
href="#x1-90003">3<!--tex4ht:ref: sec:interpreter --></a>).
</p></li>
<li class="itemize">
<!--l. 122--><p class="indent" >We present relational interpreters for three subsets of
Scheme: the call-by-value <!--l. 123--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>λ</mi></math>-calculus
(section <a 
href="#x1-90003">3<!--tex4ht:ref: sec:interpreter --></a>); <!--l. 124--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>λ</mi></math>-calculus
extended with <span 
class="cmti-9">list </span>and <span 
class="cmbx-9">quote </span>(section <a 
href="#x1-100004">4<!--tex4ht:ref: sec:extending-interpreter --></a>); and an extended
language supporting pairs, conditionals, and arithmetic
operators, and capable of running factorial (appendix <a 
href="#x1-15000A">A<!--tex4ht:ref: extendedinterpreter --></a>).
The relational arithmetic system (appendix <a 
href="#x1-16000B">B<!--tex4ht:ref: relarithsect --></a>) used in
the third interpreter  was  first  presented  in  <span class="cite"><a 
href="#Xreasoned">Friedman
et al.</a></span> (<span class="cite"><a 
href="#Xreasoned">2005</a></span>); we include it for completeness.
</p></li>
<li class="itemize">
<!--l. 130--><p class="indent" >
We demonstrate these interpreters running “backwards”
(generating input expressions from the expected output),
and show how the interpreters supporting <span 
class="cmti-9">list </span>and <span 
class="cmbx-9">quote</span>
can be used to trivially generate quines (section <a 
href="#x1-110005">5<!--tex4ht:ref: sec:quine-generation --></a> and
appendix <a 
href="#x1-15000A">A<!--tex4ht:ref: extendedinterpreter --></a>).
</p></li>
<li class="itemize">
<!--l. 135--><p class="indent" >We provide a complete, concise, and easily modifiable
implementation of core miniKanren extended with <!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math>,
<span 
class="cmti-9">symbol</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math>,
<span 
class="cmti-9">number</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math>,
and <span 
class="cmti-9">absent</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math>
constraints (appendix <a 
href="#x1-21000D">D<!--tex4ht:ref: mkimplementationsection --></a>).
</p></li>
<li class="itemize">
<!--l. 139--><p class="indent" >We                           provide                           a
generalized version of the <span 
class="cmbx-9">pmatch </span>pattern matcher first
presented in <span class="cite"><a 
href="#Xalphamk">Byrd  and  Friedman</a></span> (<span class="cite"><a 
href="#Xalphamk">2007</a></span>);  the  updated
<span 
class="cmbx-9">pmatch</span>, now  called  <span 
class="cmbx-9">dmatch </span>(appendix <a 
href="#x1-20000C">C<!--tex4ht:ref: sec:dmatch --></a>),  is  based       on  Dijkstra  guards  (<span class="cite"><a 
href="#XDijkstra:1975:GCN:360933.360975">Dijkstra</a></span> <span class="cite"><a 
href="#XDijkstra:1975:GCN:360933.360975">1975</a></span>).  This  generalized
                                       pattern  matcher  properly  handles  <span 
class="cmbx-9">quote </span>expressions,
                                       which is important when writing evaluators, inferencers,
                                       and reducers.</p></li></ul>
                                     <!--l. 150--><p class="indent" >    We begin by introducing the extended miniKanren language
                                     we will use to write the relational interpreters.
                                     </p>
                                       <h3 class="sectionHead"><span class="titlemark">2.   </span> <a 
 id="x1-60002"></a>The Extended miniKanren Language</h3>

<div class="live" id="lang-1" data-lib="appendixD">
(run 1 (q) (fresh (x y z) (== x z) (== 3 y)))
</div>

<div class="live" id="lang-2" data-lib="appendixD">
(run 1 (y)
  (fresh (x z) 
    (== x z)
    (== 3 y)))
</div>

<div class="live" id="lang-3" data-lib="appendixD">
(run 1 (q)
  (fresh (x z)
    (== x z)
    (== 3 z)
    (== q x)))
</div>

<div class="live" id="lang-4" data-lib="appendixD">
(run 1 (y)
  (fresh (x y)
    (== 4 x)
    (== x y))
  (== 3 y))
</div>

<div class="live" id="lang-5" data-lib="appendixD">
(run 1 (x) (== 4 3))
</div>

<div class="live" id="lang-6" data-lib="appendixD">
(run 1 (x) (== 5 x) (== 6 x))
</div>

<div class="live" id="lang-7" data-lib="appendixD">
(run 2 (q)
  (fresh (w x y)
    (conde
      ((== `(,x ,w ,x) q)
       (== y w))
      ((== `(,w ,x ,w) q)
       (== y w)))))
</div>

<div class="live" id="lang-8" data-lib="appendixD">
(run 6 (q)
  (let loop ()
    (conde
      ((== #f q))
      ((== #t q))
      ((loop)))))
</div>

<div class="live norun" id="anyo">
(define anyo 
  (lambda (g)
    (conde
      (g)
      ((anyo g)))))
</div>

<div class="live" id="lang-9" data-lib="appendixD anyo">
(run 5 (q)
  (conde
    ((anyo (== #f q)))
    ((== #t q))))
</div>

<div class="live" id="lang-10" data-lib="appendixD anyo">
(run 10 (q)
  (anyo 
   (conde
     ((== 1 q))
     ((== 2 q))
     ((== 3 q)))))
</div>

<div class="live" id="lang-11" data-lib="appendixD anyo">
(run 3 (q)
  (let ((nevero (anyo (== #f #t))))
    (conde
      ((== 1 q))
      (nevero)
      ((conde
         ((== 2 q))
         (nevero)
         ((== 3 q)))))))
</div>

<div class="live" id="lang-12" data-lib="appendixD">
(run* (q) (symbolo q))
</div>

<div class="live" id="lang-13" data-lib="appendixD">
(run* (q)
  (symbolo q)
  (== 4 q))
</div>

<div class="live" id="lang-14" data-lib="appendixD">
(run* (q)
  (symbolo q)
  (numbero q))
</div>

<div class="live" id="lang-15" data-lib="appendixD">
(run* (q) (numbero q))
</div>

<div class="live" id="lang-16" data-lib="appendixD">
(run* (q)
  (numbero q)
  (== 4 q))
</div>

<div class="live" id="lang-17" data-lib="appendixD">
(run* (q)
  (numbero q)
  (numbero q))
</div>

<div class="live" id="lang-18" data-lib="appendixD">
(run* (p) (=/= p 1))
</div>

<div class="live" id="lang-19" data-lib="appendixD">
(run* (p) (=/= 1 p) (== 1 p))
</div>

<div class="live" id="lang-20" data-lib="appendixD">
(run* (q)
  (fresh (p r)
    (=/= '(1 2) `(,p ,r))
    (== `(,p ,r) q)))
</div>

<div class="live" id="lang-21" data-lib="appendixD">
(run* (q)
  (fresh (p r)
    (=/= '((1) (2)) `((,p) (,r)))
    (== `(,p ,r) q)))
</div>

<div class="live" id="lang-22" data-lib="appendixD">
(run* (q)
  (fresh (p r)
    (=/= `((1) (,r)) `((,p) (2)))
    (== `(,p ,r) q)))
</div>

<div class="live" id="lang-23" data-lib="appendixD">
(run* (q)
  (fresh (p r)
    (=/= '(1 2) `(,p ,r))
    (== 1 p)
    (== `(,p ,r) q)))
</div>

<div class="live" id="lang-24" data-lib="appendixD">
(run* (q)
  (fresh (p r)
    (=/= '(1 2) `(,p ,r))
    (== 1 p)
    (== 2 r)
    (== `(,p ,r) q)))
</div>

<div class="live" id="lang-25" data-lib="appendixD">
(run* (q)
  (fresh (p r)
    (=/= '(1 2) `(,p ,r))
    (== 1 p)
    (symbolo r)
    (== `(,p ,r) q)))
</div>

<div class="live" id="lang-26" data-lib="appendixD">
(run* (q)
  (fresh (x y)
    (== `(jackal (,y leopard ,x)) q)
    (absento 'panda q)))
</div>

<div class="live" id="lang-27" data-lib="appendixD">
(run* (q)
  (fresh (x y)
    (== `(jackal (,y leopard ,x)) q)
    (absento 'panda q)
    (== 'panda x)))
</div>

<div class="live" id="lang-28" data-lib="appendixD">
(run* (q)
  (fresh (x y)
    (== `(jackal (,y leopard ,x)) q)
    (absento 'panda q)
    (symbolo x)))
</div>

<div class="live" id="lang-29" data-lib="appendixD">
(run* (q)
  (fresh (x y z)
    (== `(jackal (,y leopard ,x)) q)
    (absento 'panda q)
    (symbolo x)
    (== `(c ,z d) y)
    (== 'panda z)))
</div>



                                     <!--l. 4--><p class="noindent" >In this section we briefly review the core miniKanren
                                     language (section <a 
href="#x1-70002.1">2.1<!--tex4ht:ref: mkreferesher --></a>), then introduce the
                                     <!--l. 6--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math>,
                                     <span 
class="cmti-9">symbol</span><!--l. 9--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>,
                                     <span 
class="cmti-9">number</span><!--l. 11--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>,
                                     and <span 
class="cmti-9">absent</span><!--l. 14--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                     constraints used in the relational interpreters (section <a 
href="#x1-80002.2">2.2<!--tex4ht:ref: mknew --></a>).
                                     Readers already familiar with miniKanren can safely skip
                                     to section <a 
href="#x1-80002.2">2.2<!--tex4ht:ref: mknew --></a> to learn about the new constraints, while
                                     those wishing to learn more about miniKanren should see
                                     <span class="cite"><a 
href="#Xbyrdthesis">Byrd</a></span> (<span class="cite"><a 
href="#Xbyrdthesis">2009</a></span>), <span class="cite"><a 
href="#XByrd:2006fk">Byrd and Friedman</a></span> (<span class="cite"><a 
href="#XByrd:2006fk">2006</a></span>) (from which this
                                     subsection has been adapted), and <span class="cite"><a 
href="#Xreasoned">Friedman et al.</a></span> (<span class="cite"><a 
href="#Xreasoned">2005</a></span>).
                                     </p><!--l. 22--><p class="noindent" >
                                     </p>
                                       <h4 class="subsectionHead"><span class="titlemark">2.1   </span> <a 
 id="x1-70002.1"></a>miniKanren Refresher</h4>
                                     <!--l. 24--><p class="noindent" >Our code uses the following typographic conventions. Lexical variables
                                     are in <span 
class="cmti-9">italic</span>, forms are in <span 
class="cmbx-9">boldface</span>, and quoted symbols are in <span 
class="cmss-9">sans</span>
                                     <span 
class="cmss-9">serif</span>. By our convention, names of relations end with a superscript
                                     <!--l. 29--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math>—for example
                                     <span 
class="cmti-9">any</span><!--l. 30--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>, which is
                                     entered as <span 
class="cmtt-9">anyo</span>. Some relational operators do not follow this convention:
                                     <!--l. 34--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> (entered as
                                     <span 
class="cmtt-9">==</span>), <span 
class="cmbx-9">cond</span><!--l. 36--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>
                                     (entered as <span 
class="cmtt-9">conde</span>), and <span 
class="cmbx-9">fresh</span>. Similarly,
                                     (<span 
class="cmbx-9">run</span><!--l. 43--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="bold">5</mi></math> (<span 
class="cmti-9">q</span>) <span 
class="cmti-9">body</span>)
                                     and (<span 
class="cmbx-9">run</span><!--l. 45--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> (<span 
class="cmti-9">q</span>) <span 
class="cmti-9">body</span>)
                                     are entered as <span 
class="cmtt-9">(run 5 (q) body)</span> and
                                     <span 
class="cmtt-9">(run* (q) body)</span>.<span class="footnote-mark"><a 
href="quines3.html#fn2x0"><sup class="textsuperscript">2</sup></a></span><a 
 id="x1-7001f2"></a> 
                                     </p><!--l. 57--><p class="indent" >  Core miniKanren extends Scheme with three operators:
                                     <!--l. 58--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math>, <span 
class="cmbx-9">fresh</span>,
                                     and <span 
class="cmbx-9">cond</span><!--l. 63--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>.
                                     (Four additional constraint operators are introduced in
                                     section <a 
href="#x1-80002.2">2.2<!--tex4ht:ref: mknew --></a>.) There is also <span 
class="cmbx-9">run</span>, which serves as an interface
                                     between Scheme and miniKanren, and whose value is a
                                     list.
                                     </p><!--l. 72--><p class="indent" >  <!--l. 72--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math>
                                     unifies two terms. <span 
class="cmbx-9">fresh</span>, which syntactically looks like <span 
class="cmbx-9">lambda</span>,
                                     introduces lexically-scoped Scheme variables that are bound to
                                     new logic variables; <span 
class="cmbx-9">fresh </span>also performs conjunction of the
                                     relations within its body. Thus
                                     </p><!--l. 84--><p class="noindent" >(<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">x y z</span>) (<!--l. 85--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math>

<span 
class="cmti-9">x z</span>) (<!--l. 85--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math>
<span 
class="cmss-9">3 </span><span 
class="cmti-9">y</span>))
</p><!--l. 90--><p class="noindent" >would introduce logic variables <span 
class="cmti-9">x</span>, <span 
class="cmti-9">y</span>, and <span 
class="cmti-9">z</span>, then associate
<span 
class="cmti-9">x </span>with <span 
class="cmti-9">z </span>and <span 
class="cmti-9">y </span>with <span 
class="cmss-9">3</span>. This, however, is not a legal
miniKanren program—we must wrap a <span 
class="cmbx-9">run </span>around the entire
expression.
</p><!--l. 113--><p class="noindent" >(<span 
class="cmbx-9">run</span><!--l. 114--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="bold">1 </mi></math> (<span 
class="cmti-9">q</span>)
(<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">x y z</span>) (<!--l. 114--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math>
<span 
class="cmti-9">x z</span>) (<!--l. 114--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math>
<span 
class="cmss-9">3 </span><span 
class="cmti-9">y</span>))) <!--l. 115--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math>
(<span 
class="cmss-9">_</span><!--l. 116--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn> </mrow> </msub 
> </mrow> </msub 
> </math>)
</p><!--l. 121--><p class="noindent" >The value returned is a list containing the single value
<span 
class="cmss-9">_</span><!--l. 123--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn> </mrow> </msub 
> </mrow> </msub 
> </math>; we say
that <span 
class="cmss-9">_</span><!--l. 126--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn> </mrow> </msub 
> </mrow> </msub 
> </math>
is the <span 
class="cmti-9">reified value </span>of the unbound query variable <span 
class="cmti-9">q </span>and thus
represents any value. <span 
class="cmti-9">q </span>also remains unbound in
</p><!--l. 137--><p class="noindent" >(<span 
class="cmbx-9">run</span><!--l. 138--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="bold">1 </mi></math> (<span 
class="cmti-9">q</span>)
(<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">x y</span>) (<!--l. 138--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math>
<span 
class="cmti-9">x q</span>) (<!--l. 138--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math>
<span 
class="cmss-9">3 </span><span 
class="cmti-9">y</span>))) <!--l. 139--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math>
(<span 
class="cmss-9">_</span><!--l. 140--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn> </mrow> </msub 
> </mrow> </msub 
> </math>)
</p><!--l. 145--><p class="indent" >We can get back more interesting values by unifying the
query variable with another term.
</p><!--l. 149--><p class="indent" >(<span 
class="cmbx-9">run</span><!--l. 151--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="bold">1 </mi></math> (<span 
class="cmti-9">y</span>)
  (<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">x z</span>)
    (<!--l. 153--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmti-9">x z</span>)
    (<!--l. 154--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">3 </span><span 
class="cmti-9">y</span>)))
<!--l. 155--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.33em" class="nbsp" /></math>
(<span 
class="cmbx-9">run</span><!--l. 158--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="bold">1 </mi></math> (<span 
class="cmti-9">q</span>)
(<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">x z</span>)
(<!--l. 160--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmti-9">x z</span>)
(<!--l. 161--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">3 </span><span 
class="cmti-9">z</span>)
(<!--l. 162--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmti-9">q x</span>)))
(<span 
class="cmbx-9">run</span><!--l. 165--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="bold">1 </mi></math> (<span 
class="cmti-9">y</span>)
(<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">x y</span>)
(<!--l. 167--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">4 </span><span 
class="cmti-9">x</span>)
(<!--l. 168--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmti-9">x y</span>))
(<!--l. 169--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">3 </span><span 
class="cmti-9">y</span>))
</p><!--l. 174--><p class="noindent" >Each of these examples returns (<span 
class="cmss-9">3</span>); in the rightmost example,
the <span 
class="cmti-9">y </span>introduced by <span 
class="cmbx-9">fresh </span>is different from the <span 
class="cmti-9">y </span>introduced by
<span 
class="cmbx-9">run</span>.
</p><!--l. 188--><p class="indent" >A <span 
class="cmbx-9">run </span>expression can return the empty list, indicating that
the body of the expression is logically inconsistent.
</p><!--l. 195--><p class="noindent" >(<span 
class="cmbx-9">run</span><!--l. 196--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="bold">1 </mi></math>
(<span 
class="cmti-9">x</span>) (<!--l. 196--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">4</span>
<span 
class="cmss-9">3</span>)) <!--l. 197--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math>
()
</p><!--l. 203--><p class="noindent" >(<span 
class="cmbx-9">run</span><!--l. 204--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="bold">1 </mi></math>
(<span 
class="cmti-9">x</span>) (<!--l. 204--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">5</span>
<span 
class="cmti-9">x</span>) (<!--l. 204--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">6</span>
<span 
class="cmti-9">x</span>)) <!--l. 205--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math>
()
</p><!--l. 211--><p class="noindent" >We say that a logically inconsistent relation
<span 
class="cmti-9">fails</span>, while a logically consistent relation, such as
(<!--l. 214--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">3 3</span>),
<span 
class="cmti-9">succeeds</span>.
</p><!--l. 217--><p class="indent" ><span 
class="cmbx-9">cond</span><!--l. 217--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi> </math>,
which resembles <span 
class="cmbx-9">cond </span>syntactically, is used to produce multiple answers.
Logically, <span 
class="cmbx-9">cond</span><!--l. 222--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>
can be thought of as disjunctive normal form: each clause      represents a disjunct, and is independent of the other clauses,
                                     with the relations within a clause acting as the conjuncts. For
                                     example, this expression produces two answers.
                                     </p><!--l. 229--><p class="indent" >

(<span 
class="cmbx-9">run</span><!--l. 232--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="bold">2 </mi></math> (<span 
class="cmti-9">q</span>)
(<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">w x y</span>)
(<span 
class="cmbx-9">cond</span><!--l. 234--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi> </math>
((<!--l. 235--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">x </span>,<span 
class="cmti-9">w </span>,<span 
class="cmti-9">x</span>) <span 
class="cmti-9">q</span>)
(<!--l. 236--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmti-9">y w</span>))
((<!--l. 237--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">w </span>,<span 
class="cmti-9">x </span>,<span 
class="cmti-9">w</span>) <span 
class="cmti-9">q</span>)
(<!--l. 238--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmti-9">y w</span>))))) <!--l. 238--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math> ((<span 
class="cmti-9">_</span><!--l. 238--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">_</span><!--l. 238--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">_</span><!--l. 238--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>) (<span 
class="cmti-9">_</span><!--l. 238--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">_</span><!--l. 238--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">_</span><!--l. 238--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>))
</p><!--l. 243--><p class="noindent" >Although the two <span 
class="cmbx-9">cond</span><!--l. 244--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>
lines are different, the values returned are identical. This is because
distinct reified unbound variables are assigned distinct subscripts,
increasing from left to right—the numbering starts over again from
zero within each answer, which is why the reified value of <span 
class="cmti-9">x </span>is
<span 
class="cmss-9">_</span><!--l. 253--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn> </mrow> </msub 
> </mrow> </msub 
> </math> in the first
answer but <span 
class="cmss-9">_</span><!--l. 257--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn> </mrow> </msub 
> </mrow> </msub 
> </math>
in the second. The superscript <span 
class="cmss-9">2 </span>in <span 
class="cmbx-9">run </span>denotes the
maximum length of the resultant list. If the superscript
<!--l. 265--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> is
used, then there is no maximum imposed. This can easily lead
to infinite loops.
(<span 
class="cmbx-9">run</span><!--l. 273--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo> </math> (<span 
class="cmti-9">q</span>)
(<span 
class="cmbx-9">let </span><span 
class="cmti-9">loop </span>()
(<span 
class="cmbx-9">cond</span><!--l. 275--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi> </math>
((<!--l. 276--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmtt-9">#</span><span 
class="cmss-9">f </span><span 
class="cmti-9">q</span>))
((<!--l. 277--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmtt-9">#</span><span 
class="cmss-9">t </span><span 
class="cmti-9">q</span>))
((<span 
class="cmti-9">loop</span>))))) <!--l. 278--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math><!--l. 278--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">⊥</mo></math>
</p><!--l. 283--><p class="noindent" >If we replace <!--l. 284--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math>
by a natural number <span 
class="cmti-9">n</span>, then an <span 
class="cmti-9">n</span>-element list of alternating <span 
class="cmtt-9">#</span><span 
class="cmss-9">f</span>’s
and <span 
class="cmtt-9">#</span><span 
class="cmss-9">t</span>’s is returned. The first answer is produced by the first
<span 
class="cmbx-9">cond</span><!--l. 297--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi> </math> clause,
which associates <span 
class="cmti-9">q </span>with <span 
class="cmtt-9">#</span><span 
class="cmss-9">f</span>. To produce the second answer, the second
<span 
class="cmbx-9">cond</span><!--l. 304--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi> </math> clause is
tried. Since <span 
class="cmbx-9">cond</span><!--l. 307--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>
clauses are independent, the association between <span 
class="cmti-9">q </span>and <span 
class="cmtt-9">#</span><span 
class="cmss-9">f </span>made in the
first clause is forgotten—we say that <span 
class="cmti-9">q </span>has been <span 
class="cmti-9">refreshed</span>. In the third
<span 
class="cmbx-9">cond</span><!--l. 317--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi> </math>
clause, <span 
class="cmti-9">q </span>is refreshed again.
</p><!--l. 323--><p class="indent" >We now look at several interesting examples that rely on
<span 
class="cmti-9">any</span><!--l. 324--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math>,
which tries <span 
class="cmti-9">g </span>an unbounded number of times.
(<span 
class="cmbx-9">define </span><span 
class="cmti-9">any</span><!--l. 333--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math>
(<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">g</span>)
(<span 
class="cmbx-9">cond</span><!--l. 335--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi> </math>
(<span 
class="cmti-9">g</span>)
((<span 
class="cmti-9">any</span><!--l. 337--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math> <span 
class="cmti-9">g</span>)))))
</p><!--l. 342--><p class="indent" >Consider the first example,
(<span 
class="cmbx-9">run</span><!--l. 347--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo> </math> (<span 
class="cmti-9">q</span>)
(<span 
class="cmbx-9">cond</span><!--l. 348--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi> </math>
((<span 
class="cmti-9">any</span><!--l. 349--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math> (<!--l. 349--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmtt-9">#</span><span 
class="cmss-9">f </span><span 
class="cmti-9">q</span>)))
((<!--l. 350--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmtt-9">#</span><span 
class="cmss-9">t </span><span 
class="cmti-9">q</span>))))
</p><!--l. 355--><p class="noindent" >which does not terminate because the call to
<span 
class="cmti-9">any</span><!--l. 356--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math>
succeeds an unbounded number of times. If
<!--l. 359--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math>
were replaced by <span 
class="cmss-9">5</span>, then we would get (<span 
class="cmtt-9">#</span><span 
class="cmss-9">t </span><span 
class="cmtt-9">#</span><span 
class="cmss-9">f </span><span 
class="cmtt-9">#</span><span 
class="cmss-9">f </span><span 
class="cmtt-9">#</span><span 
class="cmss-9">f </span><span 
class="cmtt-9">#</span><span 
class="cmss-9">f</span>). (The user
should not be concerned with the order of the answers
produced.)
</p><!--l. 368--><p class="indent" >Now consider
(<span 
class="cmbx-9">run</span><!--l. 373--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="bold">10 </mi></math> (<span 
class="cmti-9">q</span>)
(<span 
class="cmti-9">any</span><!--l. 374--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math>   (<span 
class="cmbx-9">cond</span><!--l. 375--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>
                                          ((<!--l. 376--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">1 </span><span 
class="cmti-9">q</span>))
                                          ((<!--l. 377--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">2 </span><span 
class="cmti-9">q</span>))
                                          ((<!--l. 378--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">3 </span><span 
class="cmti-9">q</span>))))) <!--l. 378--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math> (<span 
class="cmss-9">1 2 3 1 2 3 1 2 3 1</span>)
                                     </p><!--l. 383--><p class="noindent" >Here the values <span 
class="cmss-9">1</span>, <span 
class="cmss-9">2</span>, and <span 
class="cmss-9">3 </span>are interleaved; our use of
                                     <span 
class="cmti-9">any</span><!--l. 391--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                     ensures that this sequence is repeated indefinitely.
                                     </p><!--l. 395--><p class="indent" >  Even if a relation within a
                                     <span 
class="cmbx-9">cond</span><!--l. 396--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>
                                     clause loops indefinitely (or <span 
class="cmti-9">diverges</span>), other
                                     <span 
class="cmbx-9">cond</span><!--l. 399--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>
                                     clauses can contribute to the answers returned by a <span 
class="cmbx-9">run</span>
                                     expression. For example,
                                     (<span 
class="cmbx-9">run</span><!--l. 409--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="bold">3</mi></math> (<span 
class="cmti-9">q</span>)
                                      (<span 
class="cmbx-9">let </span>((<span 
class="cmti-9">never</span><!--l. 410--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> (<span 
class="cmti-9">any</span><!--l. 410--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> (<!--l. 410--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmtt-9">#</span><span 
class="cmss-9">f </span><span 
class="cmtt-9">#</span><span 
class="cmss-9">t</span>))))
                                        (<span 
class="cmbx-9">cond</span><!--l. 411--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>
                                          ((<!--l. 412--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">1 </span><span 
class="cmti-9">q</span>))
                                          (<span 
class="cmti-9">never</span><!--l. 413--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>)
                                          ((<span 
class="cmbx-9">cond</span><!--l. 414--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>
                                            ((<!--l. 415--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">2 </span><span 
class="cmti-9">q</span>))
                                            (<span 
class="cmti-9">never</span><!--l. 416--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>)
                                            ((<!--l. 417--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">3 </span><span 
class="cmti-9">q</span>)))))))
                                     </p><!--l. 422--><p class="noindent" >returns  (<span 
class="cmss-9">1 2 3</span>).  Replacing
                                     <span 
class="cmbx-9">run</span><!--l. 426--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="bold">3</mi></math> with
                                     <span 
class="cmbx-9">run</span><!--l. 428--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="bold">4</mi></math> would cause
                                     divergence, since <span 
class="cmti-9">never</span><!--l. 430--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                     would loop indefinitely looking for the non-existent fourth
                                     answer.
                                     </p>
                                       <h4 class="subsectionHead"><span class="titlemark">2.2   </span> <a 
 id="x1-80002.2"></a>Additional Constraint Operators</h4>
                                     <!--l. 441--><p class="noindent" >We extend core miniKanren with four constraint operators: the disequality
                                     constraint <!--l. 443--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math>
                                     (previously described in the context of the cKanren constraint logic
                                     programming framework (<span class="cite"><a 
href="#XcKanren">Alvis et al.</a></span> <span class="cite"><a 
href="#XcKanren">2011</a></span>)); type constraints
                                     <span 
class="cmti-9">symbol</span><!--l. 447--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> and
                                     <span 
class="cmti-9">number</span><!--l. 450--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>,
                                     which are the miniKanren equivalent of Scheme’s
                                     <span 
class="cmti-9">symbol?  </span>and <span 
class="cmti-9">number?  </span>type predicates; and
                                     <span 
class="cmti-9">absent</span><!--l. 459--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>,
                                     which ensures a symbol <span 
class="cmti-9">tag </span>does not occur in a term <span 
class="cmti-9">t</span>.
                                     </p><!--l. 466--><p class="indent" >  We begin with the <span 
class="cmti-9">symbol</span><!--l. 467--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                     type constraint.
                                     </p><!--l. 472--><p class="noindent" >(<span 
class="cmbx-9">run</span><!--l. 473--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> (<span 
class="cmti-9">q</span>)
                                     (<span 
class="cmti-9">symbol</span><!--l. 473--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                     <span 
class="cmti-9">q</span>)) <!--l. 474--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math>
                                     ((<span 
class="cmss-9">_</span><!--l. 475--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> (<span 
class="cmss-9">sym </span><span 
class="cmss-9">_</span><!--l. 475--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)))
                                     </p><!--l. 480--><p class="noindent" >The  single  answer
                                     (<span 
class="cmss-9">_</span><!--l. 481--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> (<span 
class="cmss-9">sym </span><span 
class="cmss-9">_</span><!--l. 481--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>))
                                     indicates that <span 
class="cmti-9">q </span>remains unbound, and also that <span 
class="cmti-9">q </span>represents a
                                     symbol. Any attempt to associate <span 
class="cmti-9">q </span>with a non-symbol value
                                     should therefore lead to failure.
                                     </p><!--l. 494--><p class="indent" >(<span 
class="cmbx-9">run</span><!--l. 496--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> (<span 
class="cmti-9">q</span>)
  (<span 
class="cmti-9">symbol</span><!--l. 497--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">q</span>)
  (<!--l. 498--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">4 </span><span 
class="cmti-9">q</span>)) <!--l. 498--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math> ()
                                                  (<span 
class="cmbx-9">run</span><!--l. 502--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> (<span 
class="cmti-9">q</span>)
             (<span 
class="cmti-9">symbol</span><!--l. 503--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">q</span>)
             (<span 
class="cmti-9">number</span><!--l. 504--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">q</span>)) <!--l. 504--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math> ()
                                     </p><!--l. 509--><p class="indent" >  If we were to replace all occurrences of
                                     <span 
class="cmti-9">symbol</span><!--l. 510--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> by

<span 
class="cmti-9">number</span><!--l. 512--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math>
in the three examples above, the new answers produced would be
((<span 
class="cmss-9">_</span><!--l. 515--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn> </mrow> </msub 
> </mrow> </msub 
> </math> (<span 
class="cmss-9">num </span><span 
class="cmss-9">_</span><!--l. 515--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>))),
(<span 
class="cmss-9">4</span>), and ((<span 
class="cmss-9">_</span><!--l. 519--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn> </mrow> </msub 
> </mrow> </msub 
> </math> (<span 
class="cmss-9">num </span><span 
class="cmss-9">_</span><!--l. 519--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>))),
respectively.
</p><!--l. 522--><p class="indent" >Next we consider the disequality constraint
<!--l. 523--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math>.
</p><!--l. 528--><p class="noindent" >(<span 
class="cmbx-9">run</span><!--l. 529--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo> </math>
(<span 
class="cmti-9">p</span>) (<!--l. 529--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo> </math> <span 
class="cmti-9">p</span>
<span 
class="cmss-9">1</span>)) <!--l. 530--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math>
((<span 
class="cmss-9">_</span><!--l. 531--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn> </mrow> </msub 
> </mrow> </msub 
> </math> (<!--l. 531--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math> ((<span 
class="cmss-9">_</span><!--l. 531--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">1</span>)))))
</p><!--l. 536--><p class="noindent" >The answer states that <span 
class="cmti-9">p </span>remains unbound, but cannot be
associated with <span 
class="cmss-9">1</span>. Of course, violating the constraint leads to
failure:
(<span 
class="cmbx-9">run</span><!--l. 546--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo> </math> (<span 
class="cmti-9">p</span>) (<!--l. 546--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math> <span 
class="cmss-9">1 </span><span 
class="cmti-9">p</span>) (<!--l. 546--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">1 </span><span 
class="cmti-9">p</span>)) <!--l. 546--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math> ()
</p><!--l. 551--><p class="indent" >A slightly more complicated example is a disequality
constraint between two lists.
(<span 
class="cmbx-9">run</span><!--l. 556--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo> </math> (<span 
class="cmti-9">q</span>)
(<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">p r</span>)
(<!--l. 558--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo> </math> ’(<span 
class="cmss-9">1 2</span>) ‘(,<span 
class="cmti-9">p </span>,<span 
class="cmti-9">r</span>))
(<!--l. 559--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">p </span>,<span 
class="cmti-9">r</span>) <span 
class="cmti-9">q</span>))) <!--l. 559--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math> (((<span 
class="cmti-9">_</span><!--l. 559--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">_</span><!--l. 559--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>) (<!--l. 559--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math> ((<span 
class="cmti-9">_</span><!--l. 559--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">1</span>) (<span 
class="cmti-9">_</span><!--l. 559--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">2</span>)))))
</p><!--l. 564--><p class="noindent" >The answer states that <span 
class="cmti-9">p </span>and <span 
class="cmti-9">r </span>are unbound, and that <span 
class="cmti-9">p </span>cannot
be associated with <span 
class="cmss-9">1 </span>while <span 
class="cmti-9">r </span>is associated with <span 
class="cmss-9">2 </span>(and the other
way around). We would get the same answer if we were to replace
(<!--l. 583--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo> </math> ’(<span 
class="cmss-9">1 2</span>) ‘(,<span 
class="cmti-9">p </span>,<span 
class="cmti-9">r</span>)) by either
(<!--l. 586--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo> </math> ’((<span 
class="cmss-9">1</span>) (<span 
class="cmss-9">2</span>)) ‘((,<span 
class="cmti-9">p</span>) (,<span 
class="cmti-9">r</span>))) or
(<!--l. 590--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo> </math> ‘((<span 
class="cmss-9">1</span>) (,<span 
class="cmti-9">r</span>)) ‘((,<span 
class="cmti-9">p</span>) (<span 
class="cmss-9">2</span>))).
</p><!--l. 592--><p class="indent" >Now consider the <span 
class="cmbx-9">run </span>expression
(<span 
class="cmbx-9">run</span><!--l. 599--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo> </math> (<span 
class="cmti-9">q</span>)
(<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">p r</span>)
(<!--l. 601--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo> </math> ’(<span 
class="cmss-9">1 2</span>) ‘(,<span 
class="cmti-9">p </span>,<span 
class="cmti-9">r</span>))
(<!--l. 602--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">1 </span><span 
class="cmti-9">p</span>)
(<!--l. 603--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">p </span>,<span 
class="cmti-9">r</span>) <span 
class="cmti-9">q</span>))) <!--l. 603--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math> (((<span 
class="cmss-9">1 </span><span 
class="cmti-9">_</span><!--l. 603--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>) (<!--l. 603--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math> ((<span 
class="cmti-9">_</span><!--l. 603--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">2</span>)))))
</p><!--l. 608--><p class="noindent" >If we also associate <span 
class="cmti-9">r </span>with <span 
class="cmss-9">2</span>, the <span 
class="cmbx-9">run </span>expression fails.
(<span 
class="cmbx-9">run</span><!--l. 619--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo> </math> (<span 
class="cmti-9">q</span>)
(<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">p r</span>)
(<!--l. 621--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo> </math> ’(<span 
class="cmss-9">1 2</span>) ‘(,<span 
class="cmti-9">p </span>,<span 
class="cmti-9">r</span>))
(<!--l. 622--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">1 </span><span 
class="cmti-9">p</span>)
(<!--l. 623--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">2 </span><span 
class="cmti-9">r</span>)
(<!--l. 624--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">p </span>,<span 
class="cmti-9">r</span>) <span 
class="cmti-9">q</span>))) <!--l. 624--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math> ()
</p><!--l. 629--><p class="indent" >Now consider what happens when
(<!--l. 630--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">2 </span><span 
class="cmti-9">r</span>) is replaced
by (<span 
class="cmti-9">symbol</span><!--l. 633--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math> <span 
class="cmti-9">r</span>)
in the previous example. Then the <span 
class="cmbx-9">run </span>expression succeeds with the answer
(((<span 
class="cmss-9">1 </span><span 
class="cmss-9">_</span><!--l. 641--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn> </mrow> </msub 
> </mrow> </msub 
> </math>) (<span 
class="cmss-9">sym </span><span 
class="cmss-9">_</span><!--l. 641--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)))
which states that <span 
class="cmti-9">r </span>can only be associated with a symbol. The reified constraint
(<!--l. 649--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo> </math> ((<span 
class="cmss-9">_</span><!--l. 649--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">2</span>)))
(stating that <span 
class="cmti-9">r </span>cannot be associated with <span 
class="cmss-9">2</span>) is not included in
the answer, since it is subsumed by the constraint that <span 
class="cmti-9">r </span>must
be a symbol.
</p><!--l. 662--><p class="indent" >Finally we consider <span 
class="cmti-9">absent</span><!--l. 664--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>,
which ensures a symbol <span 
class="cmti-9">tag </span>does not appear in a term
<span 
class="cmti-9">t</span>. Assume we have a term <span 
class="cmti-9">q </span>containing predators
such as <span 
class="cmss-9">jackal</span>s and <span 
class="cmss-9">leopard</span>s, and we desire to keep
gentle <span 
class="cmss-9">panda</span>s out of this dangerous term. We can use
<span 
class="cmti-9">absent</span><!--l. 679--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math>
to ensure that this will occur.                           (<span 
class="cmbx-9">run</span><!--l. 685--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> (<span 
class="cmti-9">q</span>)
                                      (<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">x y</span>)
                                        (<!--l. 687--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">jackal </span>(,<span 
class="cmti-9">y </span><span 
class="cmss-9">leopard </span>,<span 
class="cmti-9">x</span>)) <span 
class="cmti-9">q</span>)
                                        (<span 
class="cmti-9">absent</span><!--l. 688--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">panda </span><span 
class="cmti-9">q</span>)))
                                     <!--l. 689--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math>
                                  </p><!--l. 691--><p class="noindent" >(((<span 
class="cmss-9">jackal </span>(<span 
class="cmss-9">_</span><!--l. 692--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">leopard </span><span 
class="cmss-9">_</span><!--l. 692--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>))
 (<span 
class="cmss-9">absent panda </span><span 
class="cmss-9">_</span><!--l. 693--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)
 (<span 
class="cmss-9">absent panda </span><span 
class="cmss-9">_</span><!--l. 694--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>)))
                                     </p><!--l. 699--><p class="noindent" >The answer states that the two unbound variables, <span 
class="cmti-9">x </span>and
                                     <span 
class="cmti-9">y</span>, cannot be associated with a term that contains the
                                     term <span 
class="cmss-9">panda</span>. If we violate this constraint by associating
                                     <span 
class="cmti-9">x </span>with <span 
class="cmss-9">panda </span>(or with a list containing <span 
class="cmss-9">panda</span>), the <span 
class="cmbx-9">run</span>
                                     expression no longer returns any answers, keeping the <span 
class="cmss-9">panda</span>s
                                     safe.
                                     (<span 
class="cmbx-9">run</span><!--l. 724--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> (<span 
class="cmti-9">q</span>)
                                      (<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">x y</span>)
                                        (<!--l. 726--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">jackal </span>(,<span 
class="cmti-9">y </span><span 
class="cmss-9">leopard </span>,<span 
class="cmti-9">x</span>)) <span 
class="cmti-9">q</span>)
                                        (<span 
class="cmti-9">absent</span><!--l. 727--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">panda </span><span 
class="cmti-9">q</span>)
                                        (<!--l. 728--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’<span 
class="cmss-9">panda </span><span 
class="cmti-9">x</span>))) <!--l. 728--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math> ()
                                     </p><!--l. 733--><p class="noindent" >If <span 
class="cmti-9">x  </span>is known to be a symbol, the
                                     <span 
class="cmti-9">absent</span><!--l. 737--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                     constraint on <span 
class="cmti-9">x </span>can be simplified to a disequality constraint
                                     between <span 
class="cmti-9">x </span>and <span 
class="cmss-9">panda</span>.
                                     (<span 
class="cmbx-9">run</span><!--l. 750--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> (<span 
class="cmti-9">q</span>)
                                      (<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">x y</span>)
                                        (<!--l. 752--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">jackal </span>(,<span 
class="cmti-9">y </span><span 
class="cmss-9">leopard </span>,<span 
class="cmti-9">x</span>)) <span 
class="cmti-9">q</span>)
                                        (<span 
class="cmti-9">absent</span><!--l. 753--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">panda </span><span 
class="cmti-9">q</span>)
                                        (<span 
class="cmti-9">symbol</span><!--l. 754--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">x</span>)))
                                     <!--l. 755--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math>
                                  </p><!--l. 757--><p class="noindent" >(((<span 
class="cmss-9">jackal </span>(<span 
class="cmss-9">_</span><!--l. 758--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">leopard </span><span 
class="cmss-9">_</span><!--l. 758--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>))
 (<!--l. 759--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math> ((<span 
class="cmss-9">_</span><!--l. 759--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">panda</span>)))
 (<span 
class="cmss-9">absent panda </span><span 
class="cmss-9">_</span><span 
class="cmss-9">_</span><!--l. 760--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)
 (<span 
class="cmss-9">sym </span><span 
class="cmss-9">_</span><!--l. 761--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>)))
                                     </p><!--l. 766--><p class="noindent" >The answer still contains the full
                                     <span 
class="cmti-9">absent</span><!--l. 768--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                     constraint on <span 
class="cmti-9">y</span>; violating this constraint does indeed cause
                                     failure.
                                     (<span 
class="cmbx-9">run</span><!--l. 777--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> (<span 
class="cmti-9">q</span>)
                                      (<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">x y z</span>)
                                        (<!--l. 779--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">jackal </span>(,<span 
class="cmti-9">y </span><span 
class="cmss-9">leopard </span>,<span 
class="cmti-9">x</span>)) <span 
class="cmti-9">q</span>)
                                        (<span 
class="cmti-9">absent</span><!--l. 780--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">panda </span><span 
class="cmti-9">q</span>)
                                        (<span 
class="cmti-9">symbol</span><!--l. 781--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">x</span>)
                                        (<!--l. 782--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">c </span>,<span 
class="cmti-9">z </span><span 
class="cmss-9">d</span>) <span 
class="cmti-9">y</span>)
                                        (<!--l. 783--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’<span 
class="cmss-9">panda </span><span 
class="cmti-9">z</span>))) <!--l. 783--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math> ()
                                     </p><!--l. 2--><p class="noindent" >
                                     </p>
                                       <h3 class="sectionHead"><span class="titlemark">3.   </span> <a 
 id="x1-90003"></a>Translating an Interpreter from Scheme to miniKanren</h3>
                                     <!--l. 4--><p class="noindent" >In this section we start with a standard
                                     environment-passing interpreter for the call-by-value
                                     <!--l. 5--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>λ</mi></math>-calculus,
                                     then show how the interpreter can be translated into miniKanren
                                     in order to run “backwards.”
                                     </p><!--l. 9--><p class="indent" >  We begin by defining variable lookup in an environment
                                     represented as an association list.
                                     (<span 
class="cmbx-9">define </span><span 
class="cmti-9">lookup</span>
                                      (<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">x env</span>)

(<span 
class="cmbx-9">dmatch </span><span 
class="cmti-9">env</span>
(() (<span 
class="cmti-9">error </span>’<span 
class="cmss-9">lookup ”unbound variable”</span>))
(((,<span 
class="cmti-9">y </span>. ,<span 
class="cmti-9">v</span>) . ,<span 
class="cmti-9">rest</span>) (<span 
class="cmbx-9">guard </span>(<span 
class="cmti-9">eq? y x</span>))
<span 
class="cmti-9">v</span>)
(((,<span 
class="cmti-9">y </span>. ,<span 
class="cmti-9">v</span>) . ,<span 
class="cmti-9">rest</span>) (<span 
class="cmbx-9">guard </span>(<span 
class="cmti-9">not </span>(<span 
class="cmti-9">eq? y x</span>)))
(<span 
class="cmti-9">lookup x rest</span>)))))
</p><!--l. 26--><p class="noindent" ><span 
class="cmti-9">lookup </span>uses <span 
class="cmbx-9">dmatch </span>(appendix <a 
href="#x1-20000C">C<!--tex4ht:ref: sec:dmatch --></a>), a simple pattern
matcher with guards in the style of Dijkstra’s Guarded
Commands (<span class="cite"><a 
href="#XDijkstra:1975:GCN:360933.360975">Dijkstra</a></span> <span class="cite"><a 
href="#XDijkstra:1975:GCN:360933.360975">1975</a></span>). <span 
class="cmbx-9">dmatch </span>ensures that the
patterns and optional guards of different clauses do not
overlap.<span class="footnote-mark"><a 
href="quines4.html#fn3x0"><sup class="textsuperscript">3 </sup> </a></span> <a 
 id="x1-9001f3"></a>  
This <span 
class="cmti-9">non-overlapping property </span>ensures that the ordering of
the clauses does not matter, and is required for writing
correct relational programs (<span class="cite"><a 
href="#Xbyrdthesis">Byrd</a></span> <span class="cite"><a 
href="#Xbyrdthesis">2009</a></span>). By ensuring the
non-overlapping property holds in the Scheme version of the
interpreter, we simplify the translation to miniKanren.
</p><!--l. 52--><p class="indent" >Now that we have defined <span 
class="cmti-9">lookup</span>, we can write our simple
interpreter using <span 
class="cmbx-9">dmatch</span>.
(<span 
class="cmbx-9">define </span><span 
class="cmti-9">eval-exp</span>
(<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">exp env</span>)
(<span 
class="cmbx-9">dmatch </span><span 
class="cmti-9">exp</span>
((,<span 
class="cmti-9">rator </span>,<span 
class="cmti-9">rand</span>)
(<span 
class="cmbx-9">let</span>((<span 
class="cmti-9">proc </span>(<span 
class="cmti-9">eval-exp rator env</span>))
(<span 
class="cmti-9">arg </span>(<span 
class="cmti-9">eval-exp rand env</span>)))
(<span 
class="cmbx-9">dmatch </span><span 
class="cmti-9">proc</span>
((<span 
class="cmss-9">closure </span>,<span 
class="cmti-9">x </span>,<span 
class="cmti-9">body </span>,<span 
class="cmti-9">env</span><!--l. 69--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow></msub 
></math>)
(<span 
class="cmti-9">eval-exp body </span>‘((,<span 
class="cmti-9">x </span>. ,<span 
class="cmti-9">arg</span>) . ,<span 
class="cmti-9">env</span><!--l. 70--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow></msub 
></math>))))))      
((<span 
class="cmss-9">lambda </span>(,<span 
class="cmti-9">x</span>) ,<span 
class="cmti-9">body</span>)
(<span 
class="cmbx-9">guard </span>(<span 
class="cmti-9">symbol? x</span>) (<span 
class="cmti-9">not-in-env? </span>’<span 
class="cmss-9">lambda </span><span 
class="cmti-9">env</span>))
‘(<span 
class="cmss-9">closure </span>,<span 
class="cmti-9">x </span>,<span 
class="cmti-9">body </span>,<span 
class="cmti-9">env</span>))
(,<span 
class="cmti-9">x </span>(<span 
class="cmbx-9">guard </span>(<span 
class="cmti-9">symbol? x</span>)) (<span 
class="cmti-9">lookup x env</span>)))))
(<span 
class="cmbx-9">define </span><span 
class="cmti-9">not-in-env?</span>
(<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">x env</span>)
(<span 
class="cmbx-9">dmatch </span><span 
class="cmti-9">env</span>
(() <span 
class="cmtt-9">#</span><span 
class="cmss-9">t</span>)
(((,<span 
class="cmti-9">y </span>. ,<span 
class="cmti-9">v</span>) . ,<span 
class="cmti-9">rest</span>) (<span 
class="cmbx-9">guard </span>(<span 
class="cmti-9">eq? y x</span>)) <span 
class="cmtt-9">#</span><span 
class="cmss-9">f</span>)      
(((,<span 
class="cmti-9">y </span>. ,<span 
class="cmti-9">v</span>) . ,<span 
class="cmti-9">rest</span>) (<span 
class="cmbx-9">guard </span>(<span 
class="cmti-9">not </span>(<span 
class="cmti-9">eq? y x</span>)))
(<span 
class="cmti-9">not-in-env? x rest</span>)))))
</p><!--l. 89--><p class="indent" >The guard in <span 
class="cmti-9">eval-exp</span>’s <span 
class="cmss-9">lambda </span>clause includes the test
</p><!--l. 97--><p class="noindent" >(<span 
class="cmti-9">not-in-env? </span>’<span 
class="cmss-9">lambda </span><span 
class="cmti-9">env</span>)
</p><!--l. 103--><p class="noindent" >When we extend the interpreter in section <a 
href="#x1-100004">4<!--tex4ht:ref: sec:extending-interpreter --></a>, and again in
appendix <a 
href="#x1-15000A">A<!--tex4ht:ref: extendedinterpreter --></a>, we will use a similar <span 
class="cmti-9">not-in-env? </span>test in the guard
of every new language form and primitive operator. This use of
<span 
class="cmti-9">not-in-env? </span>serves two critical and related purposes. First, the
test ensures that procedure application does not overlap with
any other clause in the interpreter, such as the (<span 
class="cmss-9">quote </span>,<span 
class="cmti-9">v</span>) and
(<span 
class="cmss-9">list </span>. ,<span 
class="cmti-9">a</span><!--l. 118--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo> </math>)
clauses we add in section <a 
href="#x1-100004">4<!--tex4ht:ref: sec:extending-interpreter --></a>. Second, the test ensures that
<span 
class="cmti-9">eval-exp </span>will correctly evaluate expressions in which <span 
class="cmss-9">lambda </span>(or
<span 
class="cmss-9">quote </span>or <span 
class="cmss-9">list</span>) is shadowed. For example, the interpreter
correctly handles shadowing of <span 
class="cmss-9">lambda </span>in this definition of
<!--l. 135--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="normal">Ω</mi></math>.
(<span 
class="cmbx-9">define </span><!--l. 141--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="normal">Ω</mi> </math>
’((<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">lambda</span>) (<span 
class="cmss-9">lambda lambda</span>))
(<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">lambda</span>) (<span 
class="cmss-9">lambda lambda</span>))))                  </p><!--l. 148--><p class="noindent" >As expected, <!--l. 149--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="normal">Ω</mi></math>
                                     diverges.
                                     (<span 
class="cmti-9">eval-exp </span><!--l. 155--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="normal">Ω</mi></math> ’()) <!--l. 155--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math><!--l. 155--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">⊥</mo></math>
                                     </p><!--l. 160--><p class="noindent" >The empty list passed as the second argument to <span 
class="cmti-9">eval-exp</span>
                                     represents the empty environment.
                                     </p><!--l. 165--><p class="indent" >  Here are two more examples showing <span 
class="cmti-9">eval-exp </span>in action:
                                     </p><!--l. 171--><p class="indent" >(<span 
class="cmti-9">eval-exp</span>
  ’(((<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">x</span>)
      (<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">y</span>) <span 
class="cmss-9">x</span>))
    (<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">z</span>) <span 
class="cmss-9">z</span>))
   (<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">a</span>) <span 
class="cmss-9">a</span>))
  ’())
<!--l. 179--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math>
<!--l. 180--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-open" stretchy="false">(</mo><mi 
>c</mi><mi 
>l</mi><mi 
>o</mi><mi 
>s</mi><mi 
>u</mi><mi 
>r</mi><mi 
>e</mi> <mi 
>z</mi> <mi 
>z</mi> <mo 
class="MathClass-open" stretchy="false">(</mo><mo 
class="MathClass-close" stretchy="false">)</mo><mo 
class="MathClass-close" stretchy="false">)</mo></math>    
                                     (<span 
class="cmti-9">eval-exp</span>
                                      ’((<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">x</span>)
                                         (<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">y</span>) <span 
class="cmss-9">x</span>))
                                        (<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">z</span>) <span 
class="cmss-9">z</span>))
                                       ’())
                                     <!--l. 191--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math>
                                     <!--l. 192--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-open" stretchy="false">(</mo><mi 
>c</mi><mi 
>l</mi><mi 
>o</mi><mi 
>s</mi><mi 
>u</mi><mi 
>r</mi><mi 
>e</mi> <mi 
>y</mi> <mi 
>x</mi></math>  
                                     <!--l. 195--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.33em" class="nbsp" /><mspace width="0.33em" class="nbsp" /><mo 
class="MathClass-open" stretchy="false">(</mo><mo 
class="MathClass-open" stretchy="false">(</mo><mi 
>x</mi> <mi 
>.</mi> <mo 
class="MathClass-open" stretchy="false">(</mo><mi 
>c</mi><mi 
>l</mi><mi 
>o</mi><mi 
>s</mi><mi 
>u</mi><mi 
>r</mi><mi 
>e</mi> <mi 
>z</mi> <mi 
>z</mi> <mo 
class="MathClass-open" stretchy="false">(</mo><mo 
class="MathClass-close" stretchy="false">)</mo><mo 
class="MathClass-close" stretchy="false">)</mo><mo 
class="MathClass-close" stretchy="false">)</mo><mo 
class="MathClass-close" stretchy="false">)</mo><mo 
class="MathClass-close" stretchy="false">)</mo></math>  
                                     </p><!--l. 203--><p class="indent" >  We  now  have  a  working
                                     <!--l. 203--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>λ</mi></math>-calculus
                                     interpreter in Scheme that properly handles shadowing, and in which
                                     the <span 
class="cmbx-9">dmatch </span>clauses can be reordered arbitrarily. Our next task
                                     is to translate the interpreter directly into miniKanren. We start
                                     again with environment lookup; a faithful translation of <span 
class="cmti-9">lookup </span>into
                                     <span 
class="cmti-9">lookup</span><!--l. 213--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                     might be:
                                     (<span 
class="cmbx-9">define </span><span 
class="cmti-9">lookup</span><!--l. 222--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                      (<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">x env t</span>)
                                        (<span 
class="cmbx-9">cond</span><!--l. 224--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>
                                          ((<!--l. 225--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">env</span>) <span 
class="cmti-9">fail</span>)
                                          ((<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">y v rest</span>)
                                            (<!--l. 227--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘((,<span 
class="cmti-9">y </span>. ,<span 
class="cmti-9">v</span>) . ,<span 
class="cmti-9">rest</span>) <span 
class="cmti-9">env</span>) (<!--l. 227--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmti-9">y x</span>)
                                            (<!--l. 228--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmti-9">v t</span>)))
                                          ((<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">y v rest</span>)
                                            (<!--l. 230--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘((,<span 
class="cmti-9">y </span>. ,<span 
class="cmti-9">v</span>) . ,<span 
class="cmti-9">rest</span>) <span 
class="cmti-9">env</span>) (<!--l. 230--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math> <span 
class="cmti-9">y x</span>)
                                            (<span 
class="cmti-9">lookup</span><!--l. 231--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">x rest t</span>))))))
                                     </p><!--l. 237--><p class="indent" >  <span 
class="cmti-9">lookup</span><!--l. 237--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                     takes a third argument, <span 
class="cmti-9">t</span>, which corresponds to the value
                                     returned by the Scheme function <span 
class="cmti-9">lookup</span>. That is, <span 
class="cmti-9">t </span>represents
                                     the term associated with variable <span 
class="cmti-9">x </span>in environment <span 
class="cmti-9">env</span>.
                                     (<span 
class="cmbx-9">run</span><!--l. 256--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> (<span 
class="cmti-9">q</span>) (<span 
class="cmti-9">lookup</span><!--l. 256--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">y </span>’((<span 
class="cmss-9">x </span>. <span 
class="cmss-9">foo</span>) (<span 
class="cmss-9">y </span>. <span 
class="cmss-9">bar</span>)) <span 
class="cmti-9">q</span>)) <!--l. 256--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math><!--l. 256--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-open" stretchy="false">(</mo><mi 
>b</mi><mi 
>a</mi><mi 
>r</mi><mo 
class="MathClass-close" stretchy="false">)</mo></math>
                                     </p><!--l. 263--><p class="noindent" >If <span 
class="cmti-9">x  </span>is not bound in <span 
class="cmti-9">env</span>, a call to
                                     <span 
class="cmti-9">lookup</span><!--l. 269--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> will reach the
                                     base case and fail<span class="footnote-mark"><a 
href="quines5.html#fn4x0"><sup class="textsuperscript">4</sup></a></span><a 
 id="x1-9003f4"></a> ,
                                     rather than signaling an error as in <span 
class="cmti-9">lookup</span>.
                                     (<span 
class="cmbx-9">run</span><!--l. 281--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> (<span 
class="cmti-9">q</span>) (<span 
class="cmti-9">lookup</span><!--l. 281--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">w </span>’((<span 
class="cmss-9">x </span>. <span 
class="cmss-9">foo</span>) (<span 
class="cmss-9">y </span>. <span 
class="cmss-9">bar</span>)) <span 
class="cmti-9">q</span>)) <!--l. 281--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math> ()
                                     </p><!--l. 286--><p class="indent" >  Each <span 
class="cmbx-9">cond</span><!--l. 287--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>
                                     clause in <span 
class="cmti-9">lookup</span><!--l. 289--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                     corresponds to a <span 
class="cmbx-9">dmatch </span>clause in <span 
class="cmti-9">lookup</span>.
                                     Instead of pattern matching against <span 
class="cmti-9">env</span>,

<span 
class="cmti-9">lookup</span><!--l. 299--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math> uses
<!--l. 301--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≡</mo></math> to unify terms with
<span 
class="cmti-9">env</span>. The goal (<!--l. 308--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math> <span 
class="cmti-9">y x</span>)
is equivalent to the guard (<span 
class="cmti-9">not </span>(<span 
class="cmti-9">eq? y x</span>)) in <span 
class="cmti-9">lookup</span>. As with
<span 
class="cmbx-9">dmatch</span>, the order of clauses does not affect the meaning of a
<span 
class="cmbx-9">cond</span><!--l. 318--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi> </math>
expression (but may affect its performance). Unlike
with <span 
class="cmbx-9">dmatch</span>, the order of expressions <span 
class="cmti-9">within </span>a
<span 
class="cmbx-9">cond</span><!--l. 323--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi> </math>
clause is unimportant—there are no patterns or guards within a
<span 
class="cmbx-9">cond</span><!--l. 327--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi> </math>
clause, only goals that succeed or
fail.<span class="footnote-mark"><a 
href="quines6.html#fn5x0"><sup class="textsuperscript">5 </sup> </a></span> <a 
 id="x1-9005f5"></a>  
</p><!--l. 335--><p class="indent" >We can simplify <span 
class="cmti-9">lookup</span><!--l. 336--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
by removing the first <span 
class="cmbx-9">cond</span><!--l. 338--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>
clause (which always fails), and by moving the unification of <span 
class="cmti-9">env </span>above
the <span 
class="cmbx-9">cond</span><!--l. 344--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi> </math>.
(<span 
class="cmbx-9">define </span><span 
class="cmti-9">lookup</span><!--l. 350--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
(<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">x env t</span>)
(<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">y v rest</span>)
(<!--l. 353--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘((,<span 
class="cmti-9">y </span>. ,<span 
class="cmti-9">v</span>) . ,<span 
class="cmti-9">rest</span>) <span 
class="cmti-9">env</span>)
(<span 
class="cmbx-9">cond</span><!--l. 354--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi> </math>
((<!--l. 355--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmti-9">y x</span>) (<!--l. 355--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmti-9">v t</span>))
((<!--l. 356--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo> </math> <span 
class="cmti-9">y x</span>) (<span 
class="cmti-9">lookup</span><!--l. 356--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">x rest t</span>))))))
</p><!--l. 361--><p class="indent" >With <span 
class="cmti-9">lookup</span><!--l. 362--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> defined, we
can write <span 
class="cmti-9">eval-exp</span><!--l. 364--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>, which
in turn relies on <span 
class="cmti-9">not-in-env</span><!--l. 367--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>.
Since there is no notion of a guard in miniKanren, we must
translate each <span 
class="cmbx-9">dmatch </span>guard into one or more goal expressions;
the Scheme predicate (<span 
class="cmti-9">symbol? x</span>) becomes the type constraint
(<span 
class="cmti-9">symbol</span><!--l. 378--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math> <span 
class="cmti-9">x</span>),
while (<span 
class="cmti-9">not-in-env? </span>’<span 
class="cmss-9">lambda </span><span 
class="cmti-9">env</span>) becomes
(<span 
class="cmti-9">not-in-env</span><!--l. 384--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math> ’<span 
class="cmss-9">lambda </span><span 
class="cmti-9">env</span>).
(<span 
class="cmbx-9">define </span><span 
class="cmti-9">eval-exp</span><!--l. 389--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
(<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">exp env val</span>)
(<span 
class="cmbx-9">cond</span><!--l. 391--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi> </math>
((<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">rator rand x body env</span><!--l. 392--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">a</span>)
(<!--l. 393--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">rator </span>,<span 
class="cmti-9">rand</span>) <span 
class="cmti-9">exp</span>)
(<span 
class="cmti-9">eval-exp</span><!--l. 394--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">rator env </span>‘(<span 
class="cmss-9">closure </span>,<span 
class="cmti-9">x </span>,<span 
class="cmti-9">body </span>,<span 
class="cmti-9">env</span><!--l. 394--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
>
<mn>2</mn></mrow></msub 
></mrow></msub 
></math>))
(<span 
class="cmti-9">eval-exp</span><!--l. 395--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">rand env a</span>)
(<span 
class="cmti-9">eval-exp</span><!--l. 396--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">body </span>‘((,<span 
class="cmti-9">x </span>. ,<span 
class="cmti-9">a</span>) . ,<span 
class="cmti-9">env</span><!--l. 396--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
>
<mn>2</mn></mrow></msub 
></mrow></msub 
></math>) <span 
class="cmti-9">val</span>)))
((<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">x body</span>)
(<!--l. 398--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">lambda </span>(,<span 
class="cmti-9">x</span>) ,<span 
class="cmti-9">body</span>) <span 
class="cmti-9">exp</span>)
(<span 
class="cmti-9">symbol</span><!--l. 399--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">x</span>)
(<!--l. 400--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">closure </span>,<span 
class="cmti-9">x </span>,<span 
class="cmti-9">body </span>,<span 
class="cmti-9">env</span>) <span 
class="cmti-9">val</span>)
(<span 
class="cmti-9">not-in-env</span><!--l. 401--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">lambda </span><span 
class="cmti-9">env</span>)))
((<span 
class="cmti-9">symbol</span><!--l. 402--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">exp</span>) (<span 
class="cmti-9">lookup</span><!--l. 402--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">exp env val</span>)))))
</p><!--l. 408--><p class="indent" ><span 
class="cmti-9">not-in-env</span><!--l. 408--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math>
differs from <span 
class="cmti-9">lookup</span><!--l. 410--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
and <span 
class="cmti-9">eval-exp</span><!--l. 413--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math>
in that it does not take an additional argument with respect to
the Scheme function from which it was translated. This is
because <span 
class="cmti-9">not-in-env? </span>is a predicate—the success or failure of
<span 
class="cmti-9">not-in-env</span><!--l. 420--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math>
is equivalent to <span 
class="cmti-9">not-in-env? </span>returning <span 
class="cmtt-9">#</span><span 
class="cmss-9">t </span>or <span 
class="cmtt-9">#</span><span 
class="cmss-9">f</span>, respectively, so
no “output” argument is needed.
(<span 
class="cmbx-9">define </span><span 
class="cmti-9">not-in-env</span><!--l. 434--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>(<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">x env</span>)
                                        (<span 
class="cmbx-9">cond</span><!--l. 436--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>
                                          ((<!--l. 437--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">env</span>))
                                          ((<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">y v rest</span>)
                                            (<!--l. 439--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘((,<span 
class="cmti-9">y </span>. ,<span 
class="cmti-9">v</span>) . ,<span 
class="cmti-9">rest</span>) <span 
class="cmti-9">env</span>)
                                            (<!--l. 440--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math> <span 
class="cmti-9">y x</span>)
                                            (<span 
class="cmti-9">not-in-env</span><!--l. 441--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">x rest</span>))))))
                                     </p><!--l. 446--><p class="indent" >  We can use <span 
class="cmti-9">eval-exp</span><!--l. 447--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                     to generate expression/value pairs.
                                     (<span 
class="cmbx-9">run</span><!--l. 453--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="bold">5</mi></math> (<span 
class="cmti-9">q</span>)
                                      (<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">e v</span>)
                                        (<span 
class="cmti-9">eval-exp</span><!--l. 455--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">e </span>’() <span 
class="cmti-9">v</span>)
                                        (<!--l. 456--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">e </span><!--l. 456--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">→</mo></math> ,<span 
class="cmti-9">v</span>) <span 
class="cmti-9">q</span>)))
                                     </p><!--l. 461--><p class="noindent" >This <span 
class="cmbx-9">run</span><!--l. 463--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="bold">5</mi></math> expression
                                     generates five <!--l. 464--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>λ</mi></math>-expressions,
                                     and the closures to which they evaluate.
                                     </p><!--l. 469--><p class="noindent" >((((<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 471--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>) <span 
class="cmss-9">_</span><!--l. 471--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>)
  <!--l. 472--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">→</mo></math> (<span 
class="cmss-9">closure </span><span 
class="cmss-9">_</span><!--l. 472--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">_</span><!--l. 472--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math> ()))
 (<span 
class="cmss-9">sym </span><span 
class="cmss-9">_</span><!--l. 473--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>))
 ((((<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 474--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>) <span 
class="cmss-9">_</span><!--l. 474--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>) (<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 474--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>) <span 
class="cmss-9">_</span><!--l. 474--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow></msub 
></math>))
  <!--l. 475--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">→</mo></math> (<span 
class="cmss-9">closure </span><span 
class="cmss-9">_</span><!--l. 475--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">_</span><!--l. 475--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow></msub 
></math> ()))
 (<span 
class="cmss-9">sym </span><span 
class="cmss-9">_</span><!--l. 476--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">_</span><!--l. 476--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>))
 ((((<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 477--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>) (<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 477--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>) <span 
class="cmss-9">_</span><!--l. 477--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow></msub 
></math>)) (<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 477--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>3</mn></mrow></msub 
></mrow></msub 
></math>) <span 
class="cmss-9">_</span><!--l. 477--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>4</mn></mrow></msub 
></mrow></msub 
></math>))
  <!--l. 478--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">→</mo></math> (<span 
class="cmss-9">closure </span><span 
class="cmss-9">_</span><!--l. 478--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">_</span><!--l. 478--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow></msub 
></math> ((<span 
class="cmss-9">_</span><!--l. 478--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> . (<span 
class="cmss-9">closure </span><span 
class="cmss-9">_</span><!--l. 478--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>3</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">_</span><!--l. 478--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>4</mn></mrow></msub 
></mrow></msub 
></math> ())))))
 (<!--l. 479--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math> ((<span 
class="cmss-9">_</span><!--l. 479--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">lambda</span>)))
 (<span 
class="cmss-9">sym </span><span 
class="cmss-9">_</span><!--l. 480--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">_</span><!--l. 480--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">_</span><!--l. 480--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>3</mn></mrow></msub 
></mrow></msub 
></math>))
 ((((<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 481--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>) (<span 
class="cmss-9">_</span><!--l. 481--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">_</span><!--l. 481--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)) (<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 481--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>) <span 
class="cmss-9">_</span><!--l. 481--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>))
  <!--l. 482--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">→</mo></math> (<span 
class="cmss-9">closure </span><span 
class="cmss-9">_</span><!--l. 482--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">_</span><!--l. 482--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math> ()))
 (<span 
class="cmss-9">sym </span><span 
class="cmss-9">_</span><!--l. 483--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">_</span><!--l. 483--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>))
 ((((<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 484--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>) (<span 
class="cmss-9">_</span><!--l. 484--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">_</span><!--l. 484--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>))
   (<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 485--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>) (<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 485--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow></msub 
></math>) <span 
class="cmss-9">_</span><!--l. 485--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>3</mn></mrow></msub 
></mrow></msub 
></math>)))
  <!--l. 486--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">→</mo></math> (<span 
class="cmss-9">closure </span><span 
class="cmss-9">_</span><!--l. 486--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">_</span><!--l. 486--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>3</mn></mrow></msub 
></mrow></msub 
></math> ((<span 
class="cmss-9">_</span><!--l. 486--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math> . (<span 
class="cmss-9">closure </span><span 
class="cmss-9">_</span><!--l. 486--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math> (<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 486--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow></msub 
></math>) <span 
class="cmss-9">_</span><!--l. 486--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>3</mn></mrow></msub 
></mrow></msub 
></math>) ())))))
 (<!--l. 487--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math> ((<span 
class="cmss-9">_</span><!--l. 487--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">lambda</span>)))
 (<span 
class="cmss-9">sym </span><span 
class="cmss-9">_</span><!--l. 488--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">_</span><!--l. 488--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">_</span><!--l. 488--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow></msub 
></math>)))
                                     </p><!--l. 493--><p class="noindent" >The <!--l. 495--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math> tags
                                     in the answers indicate disequality constraints between variables and
                                     the values they cannot assume. The constraints in the last answer state
                                     that <span 
class="cmss-9">_</span><!--l. 500--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>
                                     cannot be the symbol <span 
class="cmss-9">lambda </span>and that
                                     <span 
class="cmss-9">_</span><!--l. 506--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>,
                                     <span 
class="cmss-9">_</span><!--l. 509--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>, and
                                     <span 
class="cmss-9">_</span><!--l. 513--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow></msub 
></math> are
                                     symbols.
                                     </p><!--l. 517--><p class="indent" >  To demonstrate <span 
class="cmti-9">eval-exp</span><!--l. 518--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                     running backwards, here are five Scheme expressions that
                                     evaluate to the closure from the last <span 
class="cmti-9">eval-exp </span>example:
                                     (<span 
class="cmbx-9">run</span><!--l. 528--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="bold">5</mi></math> (<span 
class="cmti-9">q</span>)
                                      (<span 
class="cmti-9">eval-exp</span><!--l. 529--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">q </span>’() ’(<span 
class="cmss-9">closure y x </span>((<span 
class="cmss-9">x </span>. (<span 
class="cmss-9">closure z z </span>()))))))
                                     <!--l. 530--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math>
                                  </p><!--l. 532--><p class="noindent" >(((<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">x</span>) (<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">y</span>) <span 
class="cmss-9">x</span>)) (<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">z</span>) <span 
class="cmss-9">z</span>))
 ((<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">x</span>) (<span 
class="cmss-9">x </span>(<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">y</span>) <span 
class="cmss-9">x</span>))) (<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">z</span>) <span 
class="cmss-9">z</span>))
 (((<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">x</span>) (<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">y</span>) <span 
class="cmss-9">x</span>))
  ((<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 536--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>) <span 
class="cmss-9">_</span><!--l. 536--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>) (<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">z</span>) <span 
class="cmss-9">z</span>)))
 (<span 
class="cmss-9">sym </span><span 
class="cmss-9">_</span><!--l. 537--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>))
 ((((<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 538--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>) <span 
class="cmss-9">_</span><!--l. 538--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>) (<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">x</span>) (<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">y</span>) <span 
class="cmss-9">x</span>)))
  (<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">z</span>) <span 
class="cmss-9">z</span>))
 (<span 
class="cmss-9">sym </span><span 
class="cmss-9">_</span><!--l. 540--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>))
 (((<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 541--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>) <span 
class="cmss-9">_</span><!--l. 541--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)
  ((<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">x</span>) (<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">y</span>) <span 
class="cmss-9">x</span>)) (<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">z</span>) <span 
class="cmss-9">z</span>)))
 (<span 
class="cmss-9">sym </span><span 
class="cmss-9">_</span><!--l. 543--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)))

</p><!--l. 548--><p class="noindent" >The constraint (<span 
class="cmss-9">sym </span><span 
class="cmss-9">_</span><!--l. 550--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)
states that the fresh variable reified as
<span 
class="cmss-9">_</span><!--l. 553--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn> </mrow> </msub 
> </mrow> </msub 
> </math>
can only be associated with a symbol.
</p>
<h3 class="sectionHead"><span class="titlemark">4. </span> <a 
 id="x1-100004"></a>Extending the Interpreter</h3>
<!--l. 3--><p class="noindent" >We have a relational interpreter, but we cannot yet generate quines, or even
evaluate <span 
class="cmti-9">quine</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>c</mi></math>
from section <a 
href="#x1-50001">1<!--tex4ht:ref: intro:sec --></a> when running forward. We must add <span 
class="cmbx-9">quote </span>and
<span 
class="cmti-9">list </span>to the interpreter, first to the Scheme version, then to
miniKanren translation.
</p><!--l. 17--><p class="indent" >Adding <span 
class="cmbx-9">quote </span>to the Scheme interpreter is relatively simple.
Since <span 
class="cmbx-9">quote </span>means “do not evaluate the argument,” we simply
have to return the argument unmodified. Thus, we can support
<span 
class="cmbx-9">quote </span>by adding this clause to our interpreter:
((<span 
class="cmss-9">quote </span>,<span 
class="cmti-9">v</span>) <span 
class="cmti-9">v</span>)
</p><!--l. 33--><p class="noindent" >In order to handle shadowing correctly, we must allow the user
to override the <span 
class="cmbx-9">quote </span>form. As with the <span 
class="cmss-9">lambda </span>clause, we do so
by calling <span 
class="cmti-9">not-in-env? </span>within a guard:
((<span 
class="cmss-9">quote </span>,<span 
class="cmti-9">v</span>) (<span 
class="cmbx-9">guard </span>(<span 
class="cmti-9">not-in-env? </span>’<span 
class="cmss-9">quote </span><span 
class="cmti-9">env</span>)) <span 
class="cmti-9">v</span>)
</p><!--l. 46--><p class="indent" >Unfortunately, <span 
class="cmbx-9">quote </span>introduces a new problem: it is
possible for quoted data to conflict with our representation of
closures. For example, in the context of our interpreter, these
two expressions are equivalent:
</p><!--l. 53--><p class="noindent" >((<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">x</span>) <span 
class="cmss-9">x</span>) (<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">y</span>) <span 
class="cmss-9">y</span>)))
</p><!--l. 57--><p class="noindent" >and
</p><!--l. 61--><p class="noindent" >((<span 
class="cmss-9">quote </span>(<span 
class="cmss-9">closure x x </span>())) (<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">y</span>) <span 
class="cmss-9">y</span>))
</p><!--l. 65--><p class="noindent" >This is because (<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">x</span>) <span 
class="cmss-9">x</span>) and (<span 
class="cmss-9">quote </span>(<span 
class="cmss-9">closure x x </span>())) both
evaluate to (<span 
class="cmss-9">closure x x </span>()). We circumvent this issue by
declaring that the <span 
class="cmss-9">closure </span>tag is a unique symbol that is not part
of the expression language (a gensym by convention).
</p><!--l. 112--><p class="indent" >We can now translate the <span 
class="cmss-9">quote </span>clause to miniKanren. In the
Scheme version, we can assume that the user will not write
expressions containing the <span 
class="cmss-9">closure </span>tag; alternatively, we
could use an actual gensym for the tag. However, we are
interested in running our relational interpreter backwards,
and miniKanren has no compunction against generating
expressions that include a symbol the user cannot or
should not type. We can solve this problem by adding an
<span 
class="cmti-9">absent</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math>
constraint with the symbol <span 
class="cmss-9">closure </span>as the first argument,
ensuring the <span 
class="cmss-9">closure </span>tag does not appear within <span 
class="cmti-9">v</span>.
((<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">v</span>)
(<!--l. 3--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">quote </span>,<span 
class="cmti-9">v</span>) <span 
class="cmti-9">exp</span>)
(<span 
class="cmti-9">not-in-env</span><!--l. 4--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">quote </span><span 
class="cmti-9">env</span>)
(<span 
class="cmti-9">absent</span><!--l. 5--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">closure </span><span 
class="cmti-9">v</span>)))
</p><!--l. 134--><p class="noindent" >Like the <span 
class="cmss-9">lambda </span>clause presented in section <a 
href="#x1-90003">3<!--tex4ht:ref: sec:interpreter --></a>, the <span 
class="cmss-9">quote </span>clause uses
<span 
class="cmti-9">not-in-env</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math>
to handle shadowing.
</p><!--l. 140--><p class="indent" >We now turn our attention to <span 
class="cmti-9">list</span>. For the Scheme interpreter,
<span 
class="cmti-9">list </span>is simply a matter of mapping recursive calls to <span 
class="cmti-9">eval-exp</span>
over the arguments:
((<span 
class="cmss-9">list </span>. ,<span 
class="cmti-9">a</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math>) (<span 
class="cmbx-9">guard </span>(<span 
class="cmti-9">not-in-env? </span>’<span 
class="cmss-9">list </span><span 
class="cmti-9">env</span>))
(<span 
class="cmti-9">map </span>(<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">e</span>) (<span 
class="cmti-9">eval-exp e env</span>)) <span 
class="cmti-9">a</span><!--l. 3--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math>))</p><!--l. 153--><p class="noindent" >Similarly, we can add <span 
class="cmti-9">list </span>to the miniKanren interpreter:
                                           ((<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">a</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math>)
                                             (<!--l. 3--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">list </span>. ,<span 
class="cmti-9">a</span><!--l. 3--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math>) <span 
class="cmti-9">exp</span>)
                                             (<span 
class="cmti-9">not-in-env</span><!--l. 4--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">list </span><span 
class="cmti-9">env</span>)
                                             (<span 
class="cmti-9">absent</span><!--l. 5--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">closure </span><span 
class="cmti-9">a</span><!--l. 5--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math>)
                                             (<span 
class="cmti-9">proper-list</span><!--l. 6--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">a</span><!--l. 6--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> <span 
class="cmti-9">env val</span>)))
                                     </p><!--l. 168--><p class="noindent" >Once again, we use the <span 
class="cmti-9">absent</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                     constraint to prevent miniKanren from generating list <span 
class="cmti-9">expressions</span>
                                     that contain closures. (Of course, a list expression containing
                                     <!--l. 172--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>λ</mi></math>
                                     expressions will <span 
class="cmti-9">evaluate </span>to a list containing closures, but the
                                     expression being evaluated must not contain closures.)
                                     </p><!--l. 176--><p class="indent" >  As with the other tagged clauses, proper
                                     handling of shadowing is ensured through use of
                                     <span 
class="cmti-9">not-in-env</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>. These
                                     uses of <span 
class="cmti-9">not-in-env</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                     also serve another purpose: without this constraint, the
                                     expression (<span 
class="cmss-9">list </span><span 
class="cmti-9">x</span>) would be recognized both as a procedure
                                     application (of whatever procedure might be bound to
                                     the variable <span 
class="cmti-9">list</span>), and as a use of the built-in primitive
                                     <span 
class="cmti-9">list</span>.
                                     </p><!--l. 184--><p class="indent" >  The  <span 
class="cmss-9">list  </span>clause  relies  on
                                     <span 
class="cmti-9">proper-list</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                     to ensure <span 
class="cmti-9">a</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math>
                                     is a proper list:
                                     (<span 
class="cmbx-9">define </span><span 
class="cmti-9">proper-list</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                      (<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">exp env val</span>)
                                        (<span 
class="cmbx-9">cond</span><!--l. 4--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>
                                          ((<!--l. 5--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">exp</span>)
                                           (<!--l. 6--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">val</span>))
                                          ((<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">a d v-a v-d</span>)
                                            (<!--l. 8--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">a </span>. ,<span 
class="cmti-9">d</span>) <span 
class="cmti-9">exp</span>)
                                            (<!--l. 9--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">v-a </span>. ,<span 
class="cmti-9">v-d</span>) <span 
class="cmti-9">val</span>)
                                            (<span 
class="cmti-9">eval-exp</span><!--l. 10--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">a env v-a</span>)
                                            (<span 
class="cmti-9">proper-list</span><!--l. 11--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">d env v-d</span>))))))
                                     </p><!--l. 239--><p class="indent" >  Our final definition of <span 
class="cmti-9">eval-exp </span>is
                                     (<span 
class="cmbx-9">define </span><span 
class="cmti-9">eval-exp</span>
                                      (<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">exp env</span>)
                                        (<span 
class="cmbx-9">dmatch </span><span 
class="cmti-9">exp</span>
                                          ((<span 
class="cmss-9">quote </span>,<span 
class="cmti-9">v</span>) (<span 
class="cmbx-9">guard </span>(<span 
class="cmti-9">not-in-env? </span>’<span 
class="cmss-9">quote </span><span 
class="cmti-9">env</span>)) <span 
class="cmti-9">v</span>)
                                          ((<span 
class="cmss-9">list </span>. ,<span 
class="cmti-9">a</span><!--l. 6--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math>) (<span 
class="cmbx-9">guard </span>(<span 
class="cmti-9">not-in-env? </span>’<span 
class="cmss-9">list </span><span 
class="cmti-9">env</span>))
                                           (<span 
class="cmti-9">map </span>(<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">e</span>) (<span 
class="cmti-9">eval-exp e env</span>)) <span 
class="cmti-9">a</span><!--l. 7--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math>))
                                          (,<span 
class="cmti-9">x </span>(<span 
class="cmbx-9">guard </span>(<span 
class="cmti-9">symbol? x</span>)) (<span 
class="cmti-9">lookup x env</span>))
                                          ((,<span 
class="cmti-9">rator </span>,<span 
class="cmti-9">rand</span>)
                                           (<span 
class="cmbx-9">guard </span>(<span 
class="cmti-9">rator? rator env</span>))
                                           (<span 
class="cmbx-9">let</span> ((<span 
class="cmti-9">proc </span>(<span 
class="cmti-9">eval-exp rator env</span>))
                                               (<span 
class="cmti-9">arg </span>(<span 
class="cmti-9">eval-exp rand env</span>)))
                                             (<span 
class="cmbx-9">dmatch </span><span 
class="cmti-9">proc</span>
                                               ((<span 
class="cmss-9">closure </span>,<span 
class="cmti-9">x </span>,<span 
class="cmti-9">body </span>,<span 
class="cmti-9">env</span>)
                                               (<span 
class="cmti-9">eval-exp body </span>‘((,<span 
class="cmti-9">x </span>. ,<span 
class="cmti-9">arg</span>) . ,<span 
class="cmti-9">env</span>))))))
                                          ((<span 
class="cmss-9">lambda </span>(,<span 
class="cmti-9">x</span>) ,<span 
class="cmti-9">body</span>)
                                           (<span 
class="cmbx-9">guard </span>(<span 
class="cmti-9">symbol? x</span>) (<span 
class="cmti-9">not-in-env? </span>’<span 
class="cmss-9">lambda </span><span 
class="cmti-9">env</span>))
                                           ‘(<span 
class="cmss-9">closure </span>,<span 
class="cmti-9">x </span>,<span 
class="cmti-9">body </span>,<span 
class="cmti-9">env</span>)))))
                                     (<span 
class="cmbx-9">define </span><span 
class="cmti-9">rator?</span>
                                      (<span 
class="cmbx-9">let </span>((<span 
class="cmti-9">op-names </span>’(<span 
class="cmss-9">lambda quote list</span>)))
                                        (<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">x env</span>)
                                          (<span 
class="cmti-9">not</span> (<span 
class="cmbx-9">and</span> (<span 
class="cmti-9">symbol? x</span>)
                                                  (<span 
class="cmti-9">memq x op-names</span>)
                                                  (<span 
class="cmti-9">not-in-env? x env</span>))))))
                                     </p><!--l. 302--><p class="indent" >  The <span 
class="cmti-9">rator? </span>predicate is used to ensure the procedure

application clause does not overlap with the <span 
class="cmss-9">lambda</span>, <span 
class="cmss-9">list</span>, or
<span 
class="cmss-9">quote </span>clauses. An expression <span 
class="cmti-9">x </span>is an operator, <span 
class="cmti-9">unless </span>it one of
the symbols <span 
class="cmss-9">lambda</span>, <span 
class="cmss-9">list</span>, or <span 
class="cmss-9">quote</span>, <span 
class="cmti-9">and </span>it is not bound
in the environment. (If <span 
class="cmti-9">x </span>is bound in <span 
class="cmti-9">env</span>, it means the
operator is being shadowed, and that <span 
class="cmti-9">exp </span>is a procedure
application).
</p><!--l. 319--><p class="indent" >The definition of <span 
class="cmti-9">eval-exp </span>in section <a 
href="quines4.html#x4-9002x3">3<!--tex4ht:ref: lambdacalevalexp --></a>
does not need to use <span 
class="cmti-9">rator? </span>because the three
<!--l. 321--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>λ</mi></math>-calculus
expressions have different shapes: applications are represented
by lists of length two, abstractions are represented by lists of
length three, and variables are represented by symbols.
Therefore there is no overlap between clauses, which is required
when using <span 
class="cmbx-9">dmatch</span>.
</p><!--l. 327--><p class="indent" >Here is the extended relational interpreter.
(<span 
class="cmbx-9">define </span><span 
class="cmti-9">eval-exp</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
(<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">exp env val</span>)
(<span 
class="cmbx-9">cond</span><!--l. 4--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi> </math>
((<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">v</span>)
(<!--l. 6--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">quote </span>,<span 
class="cmti-9">v</span>) <span 
class="cmti-9">exp</span>)
(<span 
class="cmti-9">not-in-env</span><!--l. 7--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">quote </span><span 
class="cmti-9">env</span>)
(<span 
class="cmti-9">absent</span><!--l. 8--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">closure </span><span 
class="cmti-9">v</span>)
(<!--l. 9--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmti-9">v val</span>)))
((<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">a</span><!--l. 10--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math>)
(<!--l. 11--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">list </span>. ,<span 
class="cmti-9">a</span><!--l. 11--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math>) <span 
class="cmti-9">exp</span>)
(<span 
class="cmti-9">not-in-env</span><!--l. 12--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">list </span><span 
class="cmti-9">env</span>)
(<span 
class="cmti-9">absent</span><!--l. 13--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">closure </span><span 
class="cmti-9">a</span><!--l. 13--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math>)
(<span 
class="cmti-9">proper-list</span><!--l. 14--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">a</span><!--l. 14--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> <span 
class="cmti-9">env val</span>)))
((<span 
class="cmti-9">symbol</span><!--l. 15--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">exp</span>) (<span 
class="cmti-9">lookup</span><!--l. 15--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">exp env val</span>))
((<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">rator rand x body envˆ a</span>)
(<!--l. 17--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">rator </span>,<span 
class="cmti-9">rand</span>) <span 
class="cmti-9">exp</span>)
(<span 
class="cmti-9">eval-exp</span><!--l. 18--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">rator env </span>‘(<span 
class="cmss-9">closure </span>,<span 
class="cmti-9">x </span>,<span 
class="cmti-9">body </span>,<span 
class="cmti-9">envˆ</span>))
(<span 
class="cmti-9">eval-exp</span><!--l. 19--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">rand env a</span>)
(<span 
class="cmti-9">eval-exp</span><!--l. 20--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">body </span>‘((,<span 
class="cmti-9">x </span>. ,<span 
class="cmti-9">a</span>) . ,<span 
class="cmti-9">envˆ</span>) <span 
class="cmti-9">val</span>)))
((<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">x body</span>)
(<!--l. 22--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">lambda </span>(,<span 
class="cmti-9">x</span>) ,<span 
class="cmti-9">body</span>) <span 
class="cmti-9">exp</span>)
(<span 
class="cmti-9">symbol</span><!--l. 23--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">x</span>)
(<span 
class="cmti-9">not-in-env</span><!--l. 24--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">lambda </span><span 
class="cmti-9">env</span>)
(<!--l. 25--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">closure </span>,<span 
class="cmti-9">x </span>,<span 
class="cmti-9">body </span>,<span 
class="cmti-9">env</span>) <span 
class="cmti-9">val</span>))))))
</p><!--l. 358--><p class="noindent" >It is not necessary to test if a rator is valid, since the
application clause will fail if <span 
class="cmti-9">rator </span>is a symbol not bound in the
environment. If <span 
class="cmti-9">exp </span>is (<span 
class="cmss-9">quote </span>(<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">x</span>) <span 
class="cmss-9">x</span>)), for example, and
<span 
class="cmti-9">env </span>contains a binding between <span 
class="cmss-9">quote </span>and a closure, then
<span 
class="cmti-9">eval-exp</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math>
will treat the expression as a procedure application, rather than
a use of the <span 
class="cmbx-9">quote </span>form; otherwise, if <span 
class="cmss-9">quote </span>is not bound to a
closure in <span 
class="cmti-9">env</span>, the application clause will fail.
</p><!--l. 1--><p class="noindent" >
</p>
<h3 class="sectionHead"><span class="titlemark">5. </span> <a 
 id="x1-110005"></a>Generating Quines</h3>
<!--l. 3--><p class="noindent" >After much work, we are finally ready to put
<span 
class="cmti-9">eval-exp</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math>
through its paces, and generate a quine. The call to
<span 
class="cmti-9">eval-exp</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math>
is trivial—we want to find a Scheme expression <span 
class="cmti-9">q </span>that, when
evaluated in the empty environment, returns itself.
(<span 
class="cmbx-9">run</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="bold">1 </mi></math> (<span 
class="cmti-9">q</span>) (<span 
class="cmti-9">eval-exp</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">q </span>’() <span 
class="cmti-9">q</span>)) <!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math> </p><!--l. 1--><p class="noindent" >((((<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn> </mrow> </msub 
> </mrow> </msub 
> </math>) (<span 
class="cmss-9">list </span><span 
class="cmss-9">_</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn> </mrow> </msub 
> </mrow> </msub 
> </math> (<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span><span 
class="cmss-9">_</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)))
  ’(<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 3--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>) (<span 
class="cmss-9">list </span><span 
class="cmss-9">_</span><!--l. 3--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> (<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span><span 
class="cmss-9">_</span><!--l. 3--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>))))
 (<!--l. 4--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math> ((<span 
class="cmss-9">_</span><!--l. 4--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">closure</span>)) ((<span 
class="cmss-9">_</span><!--l. 4--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">list</span>)) ((<span 
class="cmss-9">_</span><!--l. 4--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">quote</span>)))
 (<span 
class="cmss-9">sym </span><span 
class="cmss-9">_</span><!--l. 5--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)))
                                     </p><!--l. 22--><p class="noindent" >Sure enough, this is our old friend,
                                     <span 
class="cmti-9">quine</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>c</mi></math>.
                                     </p><!--l. 25--><p class="indent" >  We can push things further by attempting to generate
                                     <span 
class="cmti-9">twines</span>, also known as “twin quines” or “double quines.” That
                                     is, we want to find programs <span 
class="cmti-9">p </span>and <span 
class="cmti-9">q </span>such that (<span 
class="cmti-9">eval p</span>)
                                     <!--l. 27--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math><span 
class="cmti-9">q </span>and
                                     (<span 
class="cmti-9">eval q</span>) <!--l. 31--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math>
                                     <span 
class="cmti-9">p</span>. According to this definition every quine is trivially a twine, so
                                     we add the restriction that <span 
class="cmti-9">p </span>and <span 
class="cmti-9">q </span>are not equal.
                                     (<span 
class="cmbx-9">run</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="bold">1</mi></math> (<span 
class="cmti-9">x</span>)
                                      (<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">p q</span>)
                                        (<!--l. 4--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math> <span 
class="cmti-9">p q</span>)
                                        (<span 
class="cmti-9">eval-exp</span><!--l. 5--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">p </span>’() <span 
class="cmti-9">q</span>) (<span 
class="cmti-9">eval-exp</span><!--l. 5--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">q </span>’() <span 
class="cmti-9">p</span>)
                                        (<!--l. 6--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">p </span>,<span 
class="cmti-9">q</span>) <span 
class="cmti-9">x</span>)))
                                     <!--l. 7--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math> 
                                  </p><!--l. 1--><p class="noindent" >(((’((<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)
     (<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span>(<span 
class="cmss-9">list </span><span 
class="cmss-9">_</span><!--l. 3--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> (<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span><span 
class="cmss-9">_</span><!--l. 3--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>))))
   ’(<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 4--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>) (<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span>(<span 
class="cmss-9">list </span><span 
class="cmss-9">_</span><!--l. 4--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> (<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span><span 
class="cmss-9">_</span><!--l. 4--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)))))
   ((<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 5--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>) (<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span>(<span 
class="cmss-9">list </span><span 
class="cmss-9">_</span><!--l. 5--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> (<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span><span 
class="cmss-9">_</span><!--l. 5--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>))))
    ’(<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 6--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>) (<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span>(<span 
class="cmss-9">list </span><span 
class="cmss-9">_</span><!--l. 6--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> (<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span><span 
class="cmss-9">_</span><!--l. 6--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>))))))
  (<!--l. 7--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math> ((<span 
class="cmss-9">_</span><!--l. 7--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">closure</span>)) ((<span 
class="cmss-9">_</span><!--l. 7--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">list</span>)) ((<span 
class="cmss-9">_</span><!--l. 7--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">quote</span>)))
  (<span 
class="cmss-9">sym </span><span 
class="cmss-9">_</span><!--l. 8--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)))
                                     </p><!--l. 57--><p class="indent" >  Finally, we generate <span 
class="cmti-9">thrines</span>: distinct programs <span 
class="cmti-9">p</span>, <span 
class="cmti-9">q</span>, and <span 
class="cmti-9">r </span>such that
                                     (<span 
class="cmti-9">eval p</span>) <!--l. 60--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math><span 
class="cmti-9">q</span>,
                                     (<span 
class="cmti-9">eval q</span>) <!--l. 62--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math><span 
class="cmti-9">r</span>,
                                     and (<span 
class="cmti-9">eval r</span>) <!--l. 66--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math>
                                     <span 
class="cmti-9">p</span>.
                                     (<span 
class="cmbx-9">run</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="bold">1</mi></math> (<span 
class="cmti-9">x</span>)
                                      (<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">p q r</span>)
                                        (<!--l. 4--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math> <span 
class="cmti-9">p q</span>) (<!--l. 4--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math> <span 
class="cmti-9">q r</span>) (<!--l. 4--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math> <span 
class="cmti-9">r p</span>)
                                        (<span 
class="cmti-9">eval-exp</span><!--l. 5--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">p </span>’() <span 
class="cmti-9">q</span>) (<span 
class="cmti-9">eval-exp</span><!--l. 5--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">q </span>’() <span 
class="cmti-9">r</span>) (<span 
class="cmti-9">eval-exp</span><!--l. 5--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">r </span>’() <span 
class="cmti-9">p</span>)
                                        (<!--l. 6--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">p </span>,<span 
class="cmti-9">q </span>,<span 
class="cmti-9">r</span>) <span 
class="cmti-9">x</span>)))
                                     <!--l. 7--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math>
                                  </p><!--l. 1--><p class="noindent" >(((”((<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)
     (<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span>(<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span>(<span 
class="cmss-9">list </span><span 
class="cmss-9">_</span><!--l. 3--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> (<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span><span 
class="cmss-9">_</span><!--l. 3--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)))))
    ’(<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 4--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)
      (<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span>(<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span>(<span 
class="cmss-9">list </span><span 
class="cmss-9">_</span><!--l. 5--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> (<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span><span 
class="cmss-9">_</span><!--l. 5--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>))))))
   ’((<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 6--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)
      (<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span>(<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span>(<span 
class="cmss-9">list </span><span 
class="cmss-9">_</span><!--l. 7--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> (<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span><span 
class="cmss-9">_</span><!--l. 7--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)))))
    ’(<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 8--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)
      (<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span>(<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span>(<span 
class="cmss-9">list </span><span 
class="cmss-9">_</span><!--l. 9--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> (<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span><span 
class="cmss-9">_</span><!--l. 9--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>))))))
   ((<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 10--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)
     (<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span>(<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span>(<span 
class="cmss-9">list </span><span 
class="cmss-9">_</span><!--l. 11--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> (<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span><span 
class="cmss-9">_</span><!--l. 11--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)))))
    ’(<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 12--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)
      (<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span>(<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span>(<span 
class="cmss-9">list </span><span 
class="cmss-9">_</span><!--l. 13--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> (<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span><span 
class="cmss-9">_</span><!--l. 13--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)))))))
  (<!--l. 14--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math> ((<span 
class="cmss-9">_</span><!--l. 14--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">closure</span>)) ((<span 
class="cmss-9">_</span><!--l. 14--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">list</span>)) ((<span 
class="cmss-9">_</span><!--l. 14--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">quote</span>)))
  (<span 
class="cmss-9">sym </span><span 
class="cmss-9">_</span><!--l. 15--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)))
                                     </p><!--l. 1--><p class="noindent" >
                                     </p>
                                       <h3 class="sectionHead"><span class="titlemark">6.   </span> <a 
 id="x1-120006"></a>Conclusion</h3>
                                     <!--l. 3--><p class="noindent" >Quines have a long and interesting history: the term “quine”
                                     was coined by Douglas Hofstadter (<span class="cite"><a 
href="#XGEB79">1979</a></span>) in honor of the

logician Willard van Orman Quine, but the concept goes back
to Kleene’s recursion theorems (<span class="cite"><a 
href="#XRogers:1967">Rogers</a></span> <span class="cite"><a 
href="#XRogers:1967">1967</a></span>).
</p><!--l. 8--><p class="indent" >In section <a 
href="#x1-100004">4<!--tex4ht:ref: sec:extending-interpreter --></a> we describe how the
<span 
class="cmti-9">absent</span><!--l. 10--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math>
constraint can be used to distinguish general procedure
application from uses of built-in primitives, and how this
approach correctly handles shadowing of primitives. However,
there are other ways to distinguish between application
and uses of primitives. Our first efforts involved tagging
procedure applications—that is, the Scheme expression
(<span 
class="cmti-9">e</span><!--l. 19--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn> </mrow> </msub 
> </mrow> </msub 
> </math> <span 
class="cmti-9">e</span><!--l. 19--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow></msub 
></math>)
would be written in the interpreted language as
(<span 
class="cmss-9">app </span><span 
class="cmti-9">e</span><!--l. 22--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn> </mrow> </msub 
> </mrow> </msub 
> </math> <span 
class="cmti-9">e</span><!--l. 22--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow></msub 
></math>).
Although this works, it is problematic in that generated
programs are not quite Scheme programs. The tagging of
application is especially problematic in the presence of <span 
class="cmbx-9">quote</span>
and becomes most obvious when attempting to generate and
interpret quines. A special “unparser” could be used to remove
the <span 
class="cmss-9">app </span>tags, making the answers readable. The tagless
approach, however, allows the results of running the interpreter
backwards to be pasted directly into the Scheme REPL and run
without modification, while also allowing built-in forms to be
shadowed.
</p><!--l. 144--><p class="noindent" >
</p>
<h3 class="likesectionHead"><a 
 id="x1-13000"></a>Acknowledgments</h3>
<!--l. 1--><p class="noindent" >Stuart Halloway asked if an earlier version of our relational
interpreter could generate quines. His thirty-second question
inspired the work described in this paper and resulted in
significant improvements to miniKanren. We thank Stuart for
his question, and look forward to his next challenge.
</p><!--l. 7--><p class="indent" >Many students in the Indiana University <span 
class="cmss-9">pl-wonks </span>group
joined us for an advanced programming languages course the
semester after Stuart asked his question; one of the main topics
of the course was running interpreters backwards. That group of
students deserves our appreciation and thanks both for their
wisdom and enthusiasm. Among that group was Claire Alvis,
who was instrumental in implementing our constraint system
cKanren, which allowed everyone in this course to build
backward-running interpreters. She, too, deserves much
credit. We thank Jason Hemann, Aaron Todd, and Cameron
Swords for their involvement in developing software (some of
which found its way into this paper) and their generally
helpful comments. Jason also helped Dan with LaTeX and
revision control issues, and was instrumental in improving
appendix <a 
href="#x1-21000D">D<!--tex4ht:ref: mkimplementationsection --></a>.
</p><!--l. 21--><p class="indent" >None of this would have been possible without the incredibly
useful and timely observations of Mitchell Wand and Steve
Ganz. Oleg Kiselyov joined this effort early on and he has been
a constant rudder, keeping us grounded to the mathematics of
logic programming. Everything in miniKanren has been influenced
by the ideas of Oleg. Please accept our thanks for all your help.
Chung-chieh Shan offered to revise our implementation of
miniKanren, which first appeared in the <span 
class="cmti-9">The Reasoned</span>
<span 
class="cmti-9">Schemer</span>. Our later implementations, including cKanren,
<!--l. 29--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>α</mi></math>Kanren,
and this newer miniKanren, have barely veered away from
Chung-chieh’s masterful code. We appreciate and thank him for
this extraordinarily elegant code. As always, we thank Dorai
Sitaram for SLaTeX. We also thank Ramana Kumar and the
anonymous reviewers for their comments.
</p><!--l. 35--><p class="indent" >Working on a long-lived project, it is always difficult to recall all those we want to thank, but hopefully between the
                                     acknowledgments in our other papers and book we have not
                                     missed anyone.
                                     </p>


<div class="live" id="testall">
(load "testall.scm")</div>

<!--l. 1--><p class="noindent" >
                                     </p>
                                       <h3 class="likesectionHead"><a 
 id="x1-14000"></a>References</h3>
                                     <!--l. 1--><p class="noindent" >
                                      </p><div class="thebibliography">
                                      <p class="bibitem" ><span class="biblabel">
                                 <a 
 id="XcKanren"></a>    <span class="bibsp">   </span></span>Claire E. Alvis, Jeremiah J. Willcock, Kyle M. Carter,
                                      William E.  Byrd,  and  Daniel P.  Friedman.   cKanren:
                                      miniKanren with constraints.  In <span 
class="cmti-9">Workshop on Scheme</span>
                                      <span 
class="cmti-9">and Functional Programming</span>, October 2011.
                                      </p>
                                      <p class="bibitem" ><span class="biblabel">
                                 <a 
 id="Xapt03principles"></a>    <span class="bibsp">   </span></span>Krzysztof R.
                                      Apt.  <span 
class="cmti-9">Principles of Constraint Programming</span>.  Cambridge
                                      University Press, 2003.
                                      </p>
                                      <p class="bibitem" ><span class="biblabel">
                                 <a 
 id="Xbaadersnyder:handbookar:unification:2001"></a>    <span class="bibsp">   </span></span>F. Baader                    and                    W. Snyder.
                                      Unification  theory.   In  A. Robinson  and  A. Voronkov,
                                      editors,  <span 
class="cmti-9">Handbook  of  Automated  Reasoning</span>,  volume I,
                                      chapter 8, pages 445–532. Elsevier Science, 2001.  URL
                                      <a 
href="citeseer.ist.psu.edu/baader99unification.html" class="url" ><span 
class="cmtt-9">citeseer.ist.psu.edu/baader99unification.html</span></a>.
                                      </p>
                                      <p class="bibitem" ><span class="biblabel">
                                 <a 
 id="XBarendregt84"></a>    <span class="bibsp">   </span></span>Hendrik Pieter Barendregt. <span 
class="cmti-9">The Lambda Calculus – Its</span>
                                      <span 
class="cmti-9">Syntax and Semantics</span>, volume 103 of <span 
class="cmti-9">Studies in Logic and</span>
                                      <span 
class="cmti-9">the Foundations of Mathematics</span>. North-Holland, 1984.
                                      </p>
                                      <p class="bibitem" ><span class="biblabel">
                                 <a 
 id="Xobfuscated_c"></a>    <span class="bibsp">   </span></span>Leo   Broukhis,   Simon   Cooper,   and   Landon Curt
                                      Noll.   The  International  Obfuscated  C  Code  Contest.
                                      <a 
href="http://www.ioccc.org/" class="url" ><span 
class="cmtt-9">http://www.ioccc.org/</span></a>.
                                      </p>
                                      <p class="bibitem" ><span class="biblabel">
                                 <a 
 id="Xbyrdthesis"></a>    <span class="bibsp">   </span></span>William E.          Byrd.                            <span 
class="cmti-9">Relational</span>
                                      <span 
class="cmti-9">Programming in miniKanren: Techniques, Applications,</span>
                                      <span 
class="cmti-9">and Implementations</span>.   PhD  thesis,  Indiana  University,
                                      2009.
                                      </p>
                                      <p class="bibitem" ><span class="biblabel">
                                 <a 
 id="XByrd:2006fk"></a>    <span class="bibsp">   </span></span>William E.  Byrd  and  Daniel P.  Friedman.     From
                                      variadic  functions  to  variadic  relations:  A  miniKanren
                                      perspective.   In  Robby  Findler,  editor,  <span 
class="cmti-9">Proceedings  of</span>
                                      <span 
class="cmti-9">the 2006 Scheme and Functional Programming Workshop</span>,
                                      University  of  Chicago  Technical  Report  TR-2006-06,
                                      pages 105–117, 2006.
                                      </p>
                                      <p class="bibitem" ><span class="biblabel">
                                 <a 
 id="Xalphamk"></a>    <span class="bibsp">   </span></span>William E.     Byrd     and     Daniel P.     Friedman.
                                      <!--l. 55--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>α</mi></math>Kanren:
                                      A  fresh  name  in  nominal  logic  programming.     In
                                      <span 
class="cmti-9">Proceedings   of   the   2007   Workshop   on   Scheme</span>
                                      <span 
class="cmti-9">and    Functional    Programming,    Universite    Laval</span>
                                      <span 
class="cmti-9">Technical    Report    DIUL-RT-0701</span>,     pages     79–90
                                      (<span 
class="cmti-9">see   also</span>   <a 
href="http://www.cs.indiana.edu/~webyrd" class="url" ><span 
class="cmtt-9">http://www.cs.indiana.edu/</span><span 
class="cmtt-9">~</span><span 
class="cmtt-9">webyrd</span></a>  <span 
class="cmti-9">for</span>
                                      <span 
class="cmti-9">improvements</span>), 2007.
                                      </p>

<p class="bibitem" ><span class="biblabel">
<a 
 id="XDijkstra:1975:GCN:360933.360975"></a><span class="bibsp">   </span></span>Edsger W.         Dijkstra.                          Guarded
commands, nondeterminacy  and  formal  derivation  of
programs. <span 
class="cmti-9">Commun. ACM</span>, 18(8):453–457, August 1975.
</p>
<p class="bibitem" ><span class="biblabel">
<a 
 id="Xreasoned"></a><span class="bibsp">   </span></span>Daniel P. Friedman,   William E.   Byrd,   and   Oleg
Kiselyov. <span 
class="cmti-9">The  Reasoned  Schemer</span>.    The  MIT  Press,
Cambridge, MA, 2005.
</p>
<p class="bibitem" ><span class="biblabel">
<a 
 id="Xhinze2000"></a><span class="bibsp">   </span></span>Ralf Hinze. Deriving backtracking monad transformers.
In <span 
class="cmti-9">Proceedings of the Fifth ACM SIGPLAN International</span>
<span 
class="cmti-9">Conference on  Functional  Programming,  ICFP  ’00,</span>
<span 
class="cmti-9">Montreal, Canada,   September   18–21,   2000</span>,   pages
186–197. ACM Press, 2000.
</p>
<p class="bibitem" ><span class="biblabel">
<a 
 id="XGEB79"></a><span class="bibsp">   </span></span>Douglas R. Hofstadter.    <span 
class="cmti-9">G</span><span 
class="cmti-9">ö</span><span 
class="cmti-9">del,  Escher,  Bach  :  an</span>
<span 
class="cmti-9">eternal golden braid</span>. Basic, 1979.
</p>
<p class="bibitem" ><span class="biblabel">
<a 
 id="Xdeclarativearithmetic"></a><span class="bibsp">   </span></span>Oleg Kiselyov, William E. Byrd, Daniel P. Friedman,
and Chung-chieh   Shan.       Pure,   declarative,   and
constructive arithmetic relations (declarative pearl).  In
Jacques Garrigue  and  Manuel  Hermenegildo,  editors,
<span 
class="cmti-9">Proceedings of  the  9th  International  Symposium  on</span>
<span 
class="cmti-9">Functional and  Logic  Programming</span>,  volume  4989  of
<span 
class="cmti-9">LNCS</span>, pages 64–80. Springer, 2008.
</p>
<p class="bibitem" ><span class="biblabel">
<a 
 id="XLazysml98"></a><span class="bibsp">   </span></span>David B. MacQueen, Philip Wadler, and Walid Taha.
How to add laziness to a strict language without even
being odd. In <span 
class="cmti-9">Proceedings of the 1998 ACM Workshop on</span>
<span 
class="cmti-9">ML</span>, pages 24–30, September 1998. Baltimore, MD.
</p>
<p class="bibitem" ><span class="biblabel">
<a 
 id="XMoggi:ic91"></a><span class="bibsp">   </span></span>Eugenio Moggi.  Notions of computation and monads.
<span 
class="cmti-9">Information and Computation</span>, 93(1):55–92, 1991.
</p>
<p class="bibitem" ><span class="biblabel">
<a 
 id="XOkasaki99"></a><span class="bibsp">   </span></span>Chris Okasaki.     <span 
class="cmti-9">Purely  functional  data  structures</span>.
Cambridge University Press, 1999.
</p>
<p class="bibitem" ><span class="biblabel">
<a 
 id="XRogers:1967"></a><span class="bibsp">   </span></span>Hartley Rogers, Jr.  <span 
class="cmti-9">Theory of recursive functions and</span>
<span 
class="cmti-9">effective computability</span>.   McGraw-Hill,  New  York,  NY,
1967.
</p>
<p class="bibitem" ><span class="biblabel">
<a 
 id="Xthe_quine_page"></a><span class="bibsp">   </span></span>Gary P. Thompson II. The quine page (self-reproducing
code). <a 
href="http://www.nyx.org/~gthompso/quine.htm" class="url" ><span 
class="cmtt-9">http://www.nyx.org/</span><span 
class="cmtt-9">~</span><span 
class="cmtt-9">gthompso/quine.htm</span></a>.
</p>
<p class="bibitem" ><span class="biblabel">
<a 
 id="XWadler85"></a><span class="bibsp">   </span></span>Philip Wadler.    How  to  replace  failure  by  a  list  of
successes: A method for exception handling, backtracking,
and pattern matching in lazy functional languages.   In
Jean-Pierre Jouannaud, editor, <span 
class="cmti-9">Proceedings of the Second</span>
<span 
class="cmti-9">Conference on Functional Programming Languages and</span>
<span 
class="cmti-9">Computer Architecture</span>,  volume  201  of  <span 
class="cmti-9">Lecture  Notes</span>
<span 
class="cmti-9">in Computer Science</span>,  pages  113–128,  Nancy,  France,
September 16–19, 1985. Springer-Verlag.
</p>                                      <p class="bibitem" ><span class="biblabel">
                                 <a 
 id="XWadler92"></a>    <span class="bibsp">   </span></span>Philip Wadler. The essence of functional programming.
                                      In      <span 
class="cmti-9">Conference     Record     of     the     Nineteenth</span>
                                      <span 
class="cmti-9">ACM SIGPLAN-SIGACT Symposium on Principles of</span>
                                      <span 
class="cmti-9">Programming Languages</span>, pages 1–14, Albuquerque, New
                                      Mexico, January, 1992. ACM Press.
                                     </p>
                                      </div>
                                     <!--l. 4--><p class="noindent" >
                                     </p>
                                       <h3 class="sectionHead"><span class="titlemark">A.   </span> <a 
 id="x1-15000A"></a>An Extended Interpreter</h3>
                                     <!--l. 6--><p class="noindent" >Here we present a fully relational interpreter for an uncurried
                                     Scheme with arithmetic operators, conditionals, and pairs; this
                                     interpreter generates quines more slowly than the one in
                                     section <a 
href="#x1-110005">5<!--tex4ht:ref: sec:quine-generation --></a>, due to the higher branching factor.
                                     </p><!--l. 120--><p class="indent" >  Instead of using Scheme numbers,
                                     <span 
class="cmti-9">eval-exp</span><!--l. 121--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                     uses the relational arithmetic system described in appendix
                                     <a 
href="#x1-16000B">B<!--tex4ht:ref: relarithsect --></a>.
                                     (<span 
class="cmbx-9">define </span><span 
class="cmti-9">eval-exp</span><!--l. 140--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                      (<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">exp env val</span>)
                                        (<span 
class="cmbx-9">cond</span><!--l. 142--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>
                                          ((<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">v</span>)
                                            (<!--l. 144--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">quote </span>,<span 
class="cmti-9">v</span>) <span 
class="cmti-9">exp</span>)
                                            (<span 
class="cmti-9">not-in-env</span><!--l. 145--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">quote </span><span 
class="cmti-9">env</span>)
                                            (<span 
class="cmti-9">absent</span><!--l. 146--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">closure </span><span 
class="cmti-9">v</span>)
                                            (<span 
class="cmti-9">absent</span><!--l. 147--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">int-val </span><span 
class="cmti-9">v</span>)
                                            (<!--l. 148--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmti-9">v val</span>)))
                                          ((<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">a</span><!--l. 149--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math>)
                                            (<!--l. 150--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">list </span>. ,<span 
class="cmti-9">a</span><!--l. 150--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math>) <span 
class="cmti-9">exp</span>)
                                            (<span 
class="cmti-9">not-in-env</span><!--l. 151--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">list </span><span 
class="cmti-9">env</span>)
                                            (<span 
class="cmti-9">absent</span><!--l. 152--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">closure </span><span 
class="cmti-9">a</span><!--l. 152--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math>)
                                            (<span 
class="cmti-9">absent</span><!--l. 153--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">int-val </span><span 
class="cmti-9">a</span><!--l. 153--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math>)
                                            (<span 
class="cmti-9">proper-list</span><!--l. 154--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">a</span><!--l. 154--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> <span 
class="cmti-9">env val</span>)))
                                          ((<span 
class="cmti-9">prim-exp</span><!--l. 155--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">exp env val</span>))
                                          ((<span 
class="cmti-9">symbol</span><!--l. 156--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">exp</span>) (<span 
class="cmti-9">lookup</span><!--l. 156--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">exp env val</span>))
                                          ((<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">rator x</span><!--l. 157--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> <span 
class="cmti-9">rands body env</span><!--l. 157--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
>
<mn>2</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">a</span><!--l. 157--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> <span 
class="cmti-9">res</span>)
                                            (<!--l. 158--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">rator </span>. ,<span 
class="cmti-9">rands</span>) <span 
class="cmti-9">exp</span>)
                                            (<span 
class="cmti-9">eval-exp</span><!--l. 159--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">rator env </span>‘(<span 
class="cmss-9">closure </span>,<span 
class="cmti-9">x</span><!--l. 159--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> ,<span 
class="cmti-9">body </span>,<span 
class="cmti-9">env</span><!--l. 159--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
>
<mn>2</mn></mrow></msub 
></mrow></msub 
></math>))
                                            (<span 
class="cmti-9">proper-list</span><!--l. 160--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">rands env a</span><!--l. 160--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math>)
                                            (<span 
class="cmti-9">ext-env</span><!--l. 161--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mo 
class="MathClass-bin" stretchy="false">∗</mo><mi 
>o</mi></math> <span 
class="cmti-9">x</span><!--l. 161--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> <span 
class="cmti-9">a</span><!--l. 161--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> <span 
class="cmti-9">env</span><!--l. 161--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
>
<mn>2</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">res</span>)
                                            (<span 
class="cmti-9">eval-exp</span><!--l. 162--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">body res val</span>)))
                                          ((<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">x</span><!--l. 163--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> <span 
class="cmti-9">body</span>)
                                            (<!--l. 164--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">lambda </span>,<span 
class="cmti-9">x</span><!--l. 164--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> ,<span 
class="cmti-9">body</span>) <span 
class="cmti-9">exp</span>)
                                            (<span 
class="cmti-9">not-in-env</span><!--l. 165--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">lambda </span><span 
class="cmti-9">env</span>)
                                            (<!--l. 166--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">closure </span>,<span 
class="cmti-9">x</span><!--l. 166--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> ,<span 
class="cmti-9">body </span>,<span 
class="cmti-9">env</span>) <span 
class="cmti-9">val</span>))))))
                                     (<span 
class="cmbx-9">define </span><span 
class="cmti-9">ext-env</span><!--l. 170--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mo 
class="MathClass-bin" stretchy="false">∗</mo><mi 
>o</mi></math>
                                      (<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">x</span><!--l. 171--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> <span 
class="cmti-9">a</span><!--l. 171--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> <span 
class="cmti-9">env out</span>)
                                        (<span 
class="cmbx-9">cond</span><!--l. 172--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>
                                          ((<!--l. 173--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">x</span><!--l. 173--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math>) (<!--l. 173--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">a</span><!--l. 173--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math>) (<!--l. 173--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmti-9">env out</span>))
                                          ((<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">x a dx</span><!--l. 174--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math><span 
class="cmti-9">da</span><!--l. 174--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math><span 
class="cmti-9">env</span><!--l. 174--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow></msub 
></math>)
                                            (<!--l. 175--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">x </span>. ,<span 
class="cmti-9">dx</span><!--l. 175--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math>) <span 
class="cmti-9">x</span><!--l. 175--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math>)
                                            (<!--l. 176--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">a </span>. ,<span 
class="cmti-9">da</span><!--l. 176--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math>) <span 
class="cmti-9">a</span><!--l. 176--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math>)
                                            (<!--l. 177--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘((,<span 
class="cmti-9">x </span>. ,<span 
class="cmti-9">a</span>) . ,<span 
class="cmti-9">env</span>) <span 
class="cmti-9">env</span><!--l. 177--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow></msub 
></math>)
                                            (<span 
class="cmti-9">ext-env</span><!--l. 178--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mo 
class="MathClass-bin" stretchy="false">∗</mo><mi 
>o</mi></math> <span 
class="cmti-9">dx</span><!--l. 178--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math><span 
class="cmti-9">da</span><!--l. 178--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math><span 
class="cmti-9">env</span><!--l. 178--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
>
<mn>2</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">out</span>))))))
                                     </p><!--l. 181--><p class="indent" >  Primitive expressions include boolean literals,
                                     numbers (represented as tagged little-endian lists of
                                     bits), pairs, and operations over these values. The goal
                                     <span 
class="cmti-9">prim-exp</span><!--l. 184--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                     dispatches to other goals to handle these primitives. The goals to handle
                                     <span 
class="cmti-9">sub1</span>, <span 
class="cmti-9">zero?</span>, <!--l. 191--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math>,
                                     <span 
class="cmti-9">cons</span>, <span 
class="cmti-9">car</span>, <span 
class="cmti-9">cdr</span>, <span 
class="cmti-9">not</span>, and <span 
class="cmbx-9">if</span>, rely on one or more mutually-recursive calls

to <span 
class="cmti-9">eval-exp</span><!--l. 206--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math>.
(<span 
class="cmbx-9">define </span><span 
class="cmti-9">prim-exp</span><!--l. 211--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
(<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">exp env val</span>)
(<span 
class="cmbx-9">cond</span><!--l. 213--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi> </math>
((<span 
class="cmti-9">boolean-prim</span><!--l. 214--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">exp env val</span>))
((<span 
class="cmti-9">number-prim</span><!--l. 215--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">exp env val</span>))
((<span 
class="cmti-9">sub1-prim</span><!--l. 216--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">exp env val</span>))
((<span 
class="cmti-9">zero?-prim</span><!--l. 217--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">exp env val</span>))
((<span 
class="cmti-9">*-prim</span><!--l. 218--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">exp env val</span>))    
((<span 
class="cmti-9">cons-prim</span><!--l. 219--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">exp env val</span>))
((<span 
class="cmti-9">car-prim</span><!--l. 220--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">exp env val</span>))
((<span 
class="cmti-9">cdr-prim</span><!--l. 221--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">exp env val</span>))
((<span 
class="cmti-9">not-prim</span><!--l. 222--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">exp env val</span>))
((<span 
class="cmti-9">if-prim</span><!--l. 223--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">exp env val</span>)))))
(<span 
class="cmbx-9">define </span><span 
class="cmti-9">boolean-prim</span><!--l. 227--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
(<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">exp env val</span>)
(<span 
class="cmbx-9">cond</span><!--l. 229--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi> </math>
((<!--l. 230--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmtt-9">#</span><span 
class="cmss-9">t </span><span 
class="cmti-9">exp</span>) (<!--l. 230--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmtt-9">#</span><span 
class="cmss-9">t </span><span 
class="cmti-9">val</span>))
((<!--l. 231--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmtt-9">#</span><span 
class="cmss-9">f </span><span 
class="cmti-9">exp</span>) (<!--l. 231--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmtt-9">#</span><span 
class="cmss-9">f </span><span 
class="cmti-9">val</span>)))))
(<span 
class="cmbx-9">define </span><span 
class="cmti-9">number-prim</span><!--l. 235--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
(<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">exp env val</span>)
(<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">n</span>)
(<!--l. 238--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">int-exp </span>,<span 
class="cmti-9">n</span>) <span 
class="cmti-9">exp</span>)
(<!--l. 239--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">int-val </span>,<span 
class="cmti-9">n</span>) <span 
class="cmti-9">val</span>)
(<span 
class="cmti-9">not-in-env</span><!--l. 240--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">int-exp </span><span 
class="cmti-9">env</span>))))
(<span 
class="cmbx-9">define </span><span 
class="cmti-9">sub1-prim</span><!--l. 244--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
(<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">exp env val</span>)
(<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">e n n-1</span>)
(<!--l. 247--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">sub1 </span>,<span 
class="cmti-9">e</span>) <span 
class="cmti-9">exp</span>)
(<!--l. 248--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">int-val </span>,<span 
class="cmti-9">n-1</span>) <span 
class="cmti-9">val</span>)
(<span 
class="cmti-9">not-in-env</span><!--l. 249--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">sub1 </span><span 
class="cmti-9">env</span>)
(<span 
class="cmti-9">eval-exp</span><!--l. 250--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">e env </span>‘(<span 
class="cmss-9">int-val </span>,<span 
class="cmti-9">n</span>))
(<!--l. 251--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">−</mo></math><!--l. 251--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> <span 
class="cmti-9">n </span>’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">n-1</span>))))
(<span 
class="cmbx-9">define </span><span 
class="cmti-9">zero?-prim</span><!--l. 255--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
(<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">exp env val</span>)
(<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">e n</span>)
(<!--l. 258--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">zero? </span>,<span 
class="cmti-9">e</span>) <span 
class="cmti-9">exp</span>)
(<span 
class="cmbx-9">cond</span><!--l. 259--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi> </math>
((<span 
class="cmti-9">zero</span><!--l. 260--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">n</span>) (<!--l. 260--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmtt-9">#</span><span 
class="cmss-9">t </span><span 
class="cmti-9">val</span>))
((<span 
class="cmti-9">pos</span><!--l. 261--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">n</span>) (<!--l. 261--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmtt-9">#</span><span 
class="cmss-9">f </span><span 
class="cmti-9">val</span>)))
(<span 
class="cmti-9">not-in-env</span><!--l. 262--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">zero? </span><span 
class="cmti-9">env</span>)
(<span 
class="cmti-9">eval-exp</span><!--l. 263--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">e env </span>‘(<span 
class="cmss-9">int-val </span>,<span 
class="cmti-9">n</span>)))))
(<span 
class="cmbx-9">define </span><span 
class="cmti-9">*-prim</span><!--l. 267--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
(<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">exp env val</span>)
(<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">e</span><!--l. 269--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn> </mrow> </msub 
>  </mrow></msub 
></math> <span 
class="cmti-9">e</span><!--l. 269--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">n</span><!--l. 269--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">n</span><!--l. 269--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">n</span><!--l. 269--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>3</mn></mrow></msub 
></mrow></msub 
></math>)
(<!--l. 270--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<!--l. 270--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> ,<span 
class="cmti-9">e</span><!--l. 270--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math> ,<span 
class="cmti-9">e</span><!--l. 270--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow></msub 
></math>) <span 
class="cmti-9">exp</span>)
(<!--l. 271--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">int-val </span>,<span 
class="cmti-9">n</span><!--l. 271--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>3</mn></mrow></msub 
></mrow></msub 
></math>) <span 
class="cmti-9">val</span>)
(<span 
class="cmti-9">not-in-env</span><!--l. 272--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<!--l. 272--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math><span 
class="cmti-9">env</span>)
(<span 
class="cmti-9">eval-exp</span><!--l. 273--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">e</span><!--l. 273--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
>
<mn>1</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">env </span>‘(<span 
class="cmss-9">int-val </span>,<span 
class="cmti-9">n</span><!--l. 273--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>))
(<span 
class="cmti-9">eval-exp</span><!--l. 274--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">e</span><!--l. 274--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
>
<mn>2</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">env </span>‘(<span 
class="cmss-9">int-val </span>,<span 
class="cmti-9">n</span><!--l. 274--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow></msub 
></math>))
(<!--l. 275--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo><mi 
>o</mi> </math> <span 
class="cmti-9">n</span><!--l. 275--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
>
<mn>1</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">n</span><!--l. 275--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">n</span><!--l. 275--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>3</mn></mrow></msub 
></mrow></msub 
></math>))))
(<span 
class="cmbx-9">define </span><span 
class="cmti-9">cons-prim</span><!--l. 279--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
(<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">exp env val</span>)
(<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">a d v-a v-d</span>)
(<!--l. 282--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">cons </span>,<span 
class="cmti-9">a </span>,<span 
class="cmti-9">d</span>) <span 
class="cmti-9">exp</span>)
(<!--l. 283--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">v-a </span>. ,<span 
class="cmti-9">v-d</span>) <span 
class="cmti-9">val</span>)
(<span 
class="cmti-9">absent</span><!--l. 284--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">closure </span><span 
class="cmti-9">val</span>)
(<span 
class="cmti-9">absent</span><!--l. 285--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">int-val </span><span 
class="cmti-9">val</span>)
(<span 
class="cmti-9">not-in-env</span><!--l. 286--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">cons </span><span 
class="cmti-9">env</span>)
(<span 
class="cmti-9">eval-exp</span><!--l. 287--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">a env v-a</span>)
(<span 
class="cmti-9">eval-exp</span><!--l. 288--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">d env v-d</span>))))(<span 
class="cmbx-9">define </span><span 
class="cmti-9">car-prim</span><!--l. 292--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math>
                                      (<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">exp env val</span>)
                                        (<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">p d</span>)
                                          (<!--l. 295--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">car </span>,<span 
class="cmti-9">p</span>) <span 
class="cmti-9">exp</span>)
                                          (<!--l. 296--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math> ’<span 
class="cmss-9">int-val </span><span 
class="cmti-9">val</span>)
                                          (<!--l. 297--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math> ’<span 
class="cmss-9">closure </span><span 
class="cmti-9">val</span>)
                                          (<span 
class="cmti-9">not-in-env</span><!--l. 298--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">car </span><span 
class="cmti-9">env</span>)
                                          (<span 
class="cmti-9">eval-exp</span><!--l. 299--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">p env </span>‘(,<span 
class="cmti-9">val </span>. ,<span 
class="cmti-9">d</span>)))))
                                     (<span 
class="cmbx-9">define </span><span 
class="cmti-9">cdr-prim</span><!--l. 303--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                      (<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">exp env val</span>)
                                        (<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">p a</span>)
                                          (<!--l. 306--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">cdr </span>,<span 
class="cmti-9">p</span>) <span 
class="cmti-9">exp</span>)
                                          (<!--l. 307--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math> ’<span 
class="cmss-9">int-val </span><span 
class="cmti-9">a</span>)
                                          (<!--l. 308--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math> ’<span 
class="cmss-9">closure </span><span 
class="cmti-9">a</span>)
                                          (<span 
class="cmti-9">not-in-env</span><!--l. 309--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">cdr </span><span 
class="cmti-9">env</span>)
                                          (<span 
class="cmti-9">eval-exp</span><!--l. 310--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">p env </span>‘(,<span 
class="cmti-9">a </span>. ,<span 
class="cmti-9">val</span>)))))
                                     (<span 
class="cmbx-9">define </span><span 
class="cmti-9">not-prim</span><!--l. 314--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                      (<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">exp env val</span>)
                                        (<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">e b</span>)
                                          (<!--l. 317--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">not </span>,<span 
class="cmti-9">e</span>) <span 
class="cmti-9">exp</span>)
                                          (<span 
class="cmbx-9">cond</span><!--l. 318--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>
                                            ((<!--l. 319--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmtt-9">#</span><span 
class="cmss-9">t </span><span 
class="cmti-9">b</span>) (<!--l. 319--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmtt-9">#</span><span 
class="cmss-9">f </span><span 
class="cmti-9">val</span>))
                                            ((<!--l. 320--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmtt-9">#</span><span 
class="cmss-9">f </span><span 
class="cmti-9">b</span>) (<!--l. 320--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmtt-9">#</span><span 
class="cmss-9">t </span><span 
class="cmti-9">val</span>)))         
                                          (<span 
class="cmti-9">not-in-env</span><!--l. 321--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">not </span><span 
class="cmti-9">env</span>)
                                          (<span 
class="cmti-9">eval-exp</span><!--l. 322--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">e env b</span>))))
                                     (<span 
class="cmbx-9">define </span><span 
class="cmti-9">if-prim</span><!--l. 326--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                      (<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">exp env val</span>)
                                        (<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">e</span><!--l. 328--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">e</span><!--l. 328--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">e</span><!--l. 328--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>3</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">t</span>)
                                          (<!--l. 329--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">if </span>,<span 
class="cmti-9">e</span><!--l. 329--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math> ,<span 
class="cmti-9">e</span><!--l. 329--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow></msub 
></math> ,<span 
class="cmti-9">e</span><!--l. 329--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>3</mn></mrow></msub 
></mrow></msub 
></math>) <span 
class="cmti-9">exp</span>)
                                          (<span 
class="cmti-9">not-in-env</span><!--l. 330--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ’<span 
class="cmss-9">if </span><span 
class="cmti-9">env</span>)
                                          (<span 
class="cmti-9">eval-exp</span><!--l. 331--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">e</span><!--l. 331--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
>
<mn>1</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">env t</span>)
                                          (<span 
class="cmbx-9">cond</span><!--l. 332--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>
                                            ((<!--l. 333--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmtt-9">#</span><span 
class="cmss-9">t </span><span 
class="cmti-9">t</span>) (<span 
class="cmti-9">eval-exp</span><!--l. 333--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">e</span><!--l. 333--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
>
<mn>2</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">env val</span>))
                                            ((<!--l. 334--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmtt-9">#</span><span 
class="cmss-9">f </span><span 
class="cmti-9">t</span>) (<span 
class="cmti-9">eval-exp</span><!--l. 334--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">e</span><!--l. 334--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
>
<mn>3</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">env val</span>))))))
                                     </p><!--l. 340--><p class="indent" >  Now we can consider several examples using
                                     <span 
class="cmti-9">eval-exp</span><!--l. 341--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>.
                                     Consider this <span 
class="cmbx-9">run </span>expression, which returns 12 expressions that
                                     evaluate to six in the empty environment.
                                     (<span 
class="cmbx-9">run</span><!--l. 353--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="bold">12</mi></math> (<span 
class="cmti-9">q</span>) (<span 
class="cmti-9">eval-exp</span><!--l. 353--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">q </span>’() ‘(<span 
class="cmss-9">int-val </span>,(<span 
class="cmti-9">build-num </span><span 
class="cmss-9">6</span>))))
                                     <!--l. 354--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">⇒</mo></math>
                                  </p><!--l. 356--><p class="noindent" >((<span 
class="cmss-9">int-exp </span>(<span 
class="cmss-9">0 1 1</span>))
 ((<span 
class="cmss-9">lambda </span>() (<span 
class="cmss-9">int-exp </span>(<span 
class="cmss-9">0 1 1</span>))))
 (<span 
class="cmss-9">sub1 </span>(<span 
class="cmss-9">int-exp </span>(<span 
class="cmss-9">1 1 1</span>)))
 (((<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 360--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>) (<span 
class="cmss-9">int-exp </span>(<span 
class="cmss-9">0 1 1</span>))) ’<span 
class="cmss-9">_</span><!--l. 360--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>)
 (<!--l. 361--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math> ((<span 
class="cmss-9">_</span><!--l. 361--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">int-exp</span>)))
 (<span 
class="cmss-9">absent closure </span><span 
class="cmss-9">_</span><!--l. 362--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>)
 (<span 
class="cmss-9">absent int-val </span><span 
class="cmss-9">_</span><!--l. 363--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>))
 (<!--l. 364--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> (<span 
class="cmss-9">int-exp </span>(<span 
class="cmss-9">1</span>)) (<span 
class="cmss-9">int-exp </span>(<span 
class="cmss-9">0 1 1</span>)))
 (<!--l. 365--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> (<span 
class="cmss-9">int-exp </span>(<span 
class="cmss-9">0 1 1</span>)) (<span 
class="cmss-9">int-exp </span>(<span 
class="cmss-9">1</span>)))
 (<!--l. 366--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> (<span 
class="cmss-9">int-exp </span>(<span 
class="cmss-9">0 1</span>)) (<span 
class="cmss-9">int-exp </span>(<span 
class="cmss-9">1 1</span>)))
 (((<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 367--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>) (<span 
class="cmss-9">int-exp </span>(<span 
class="cmss-9">0 1 1</span>))) (<span 
class="cmss-9">list</span>))
 (<!--l. 368--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math> ((<span 
class="cmss-9">_</span><!--l. 368--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">int-exp</span>))))
 (<span 
class="cmss-9">car </span>(<span 
class="cmss-9">list </span>(<span 
class="cmss-9">int-exp </span>(<span 
class="cmss-9">0 1 1</span>))))
 ((<span 
class="cmss-9">lambda </span>() ((<span 
class="cmss-9">lambda </span>() (<span 
class="cmss-9">int-exp </span>(<span 
class="cmss-9">0 1 1</span>))))))
 (<span 
class="cmss-9">sub1 </span>((<span 
class="cmss-9">lambda </span>() (<span 
class="cmss-9">int-exp </span>(<span 
class="cmss-9">1 1 1</span>)))))
 ((<span 
class="cmss-9">lambda </span>() (<span 
class="cmss-9">sub1 </span>(<span 
class="cmss-9">int-exp </span>(<span 
class="cmss-9">1 1 1</span>))))))
                                     </p><!--l. 377--><p class="noindent" >The 7th value in this list is
                                     </p><!--l. 381--><p class="noindent" >(<!--l. 383--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> (<span 
class="cmss-9">int-exp </span>(<span 
class="cmss-9">0 1</span>)) (<span 
class="cmss-9">int-exp </span>(<span 
class="cmss-9">1 1</span>)))
                                     </p><!--l. 387--><p class="noindent" >And, if we look at the first 500 answers,
                                     (<span 
class="cmbx-9">run</span><!--l. 393--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="bold">500</mi></math> (<span 
class="cmti-9">q</span>) (<span 
class="cmti-9">eval-exp</span><!--l. 393--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">q </span>’() ‘(<span 
class="cmss-9">int-val </span>,(<span 
class="cmti-9">build-num </span><span 
class="cmss-9">6</span>))))

</p><!--l. 398--><p class="noindent" >we discover
</p><!--l. 402--><p class="noindent" >(<span 
class="cmss-9">sub1 </span>(<span 
class="cmss-9">sub1 </span>(<span 
class="cmss-9">sub1 </span>(<span 
class="cmss-9">int-exp </span>(<span 
class="cmss-9">1 0 0 1</span>)))))
</p><!--l. 408--><p class="noindent" >is the 270th value.
</p><!--l. 410--><p class="indent" >Next, we calculate the factorial of five, using “The Poorman’s Y
Combinator.”
(<span 
class="cmbx-9">define </span><span 
class="cmti-9">rel-fact5</span>
‘((<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">f</span>)
((<span 
class="cmss-9">f f</span>) (<span 
class="cmss-9">int-exp </span>,(<span 
class="cmti-9">build-num </span><span 
class="cmss-9">5</span>))))
(<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">f</span>)
(<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">n</span>)
(<span 
class="cmss-9">if</span>(<span 
class="cmss-9">zero? n</span>)
(<span 
class="cmss-9">int-exp </span>,(<span 
class="cmti-9">build-num </span><span 
class="cmss-9">1</span>))
(<!--l. 421--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math><span 
class="cmss-9">n </span>((<span 
class="cmss-9">f f</span>) (<span 
class="cmss-9">sub1 n</span>))))))))
</p><!--l. 426--><p class="noindent" >(<span 
class="cmbx-9">run</span><!--l. 427--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo> </math> (<span 
class="cmti-9">q</span>)
(<span 
class="cmti-9">eval-exp</span><!--l. 427--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math>
<span 
class="cmti-9">rel-fact5 </span>’() <span 
class="cmti-9">q</span>))<br 
class="newline" /><!--l. 429--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">⇒</mo></math>
((<span 
class="cmss-9">int-val </span>(<span 
class="cmss-9">0 0 0 1 1 1 1</span>)))
</p><!--l. 455--><p class="indent" >Now that we know our interpreter works, we are ready to
generate quines in our extended language:
(<span 
class="cmbx-9">run</span><!--l. 458--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="bold">5 </mi></math> (<span 
class="cmti-9">q</span>) (<span 
class="cmti-9">eval-exp</span><!--l. 458--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">q </span>’() <span 
class="cmti-9">q</span>))
<!--l. 459--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">⇒</mo></math>
</p><!--l. 461--><p class="noindent" >(<span 
class="cmtt-9">#</span><span 
class="cmss-9">t</span>
 <span 
class="cmtt-9">#</span><span 
class="cmss-9">f</span>
 (((<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 464--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>) (<span 
class="cmss-9">list </span><span 
class="cmss-9">_</span><!--l. 464--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> (<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span><span 
class="cmss-9">_</span><!--l. 464--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)))
  ’(<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 465--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>) (<span 
class="cmss-9">list </span><span 
class="cmss-9">_</span><!--l. 465--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> (<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span><span 
class="cmss-9">_</span><!--l. 465--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>))))
 (<!--l. 466--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math> ((<span 
class="cmss-9">_</span><!--l. 466--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">closure</span>))
                                                ((<span 
class="cmss-9">_</span><!--l. 467--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">int-val</span>))
                                                ((<span 
class="cmss-9">_</span><!--l. 468--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">list</span>))
                                                ((<span 
class="cmss-9">_</span><!--l. 469--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">quote</span>)))
 (<span 
class="cmss-9">sym </span><span 
class="cmss-9">_</span><!--l. 470--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>))
 (((<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 471--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>) (<span 
class="cmss-9">list </span><span 
class="cmss-9">_</span><!--l. 471--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> (<span 
class="cmss-9">list </span>(<span 
class="cmss-9">car </span>’(<span 
class="cmss-9">quote </span>. <span 
class="cmss-9">_</span><!--l. 471--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>)) <span 
class="cmss-9">_</span><!--l. 471--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)))
  ’(<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 472--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>) (<span 
class="cmss-9">list </span><span 
class="cmss-9">_</span><!--l. 472--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> (<span 
class="cmss-9">list </span>(<span 
class="cmss-9">car </span>’(<span 
class="cmss-9">quote </span>. <span 
class="cmss-9">_</span><!--l. 472--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>)) <span 
class="cmss-9">_</span><!--l. 472--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>))))
 (<!--l. 473--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math> ((<span 
class="cmss-9">_</span><!--l. 473--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">car</span>))
                                                ((<span 
class="cmss-9">_</span><!--l. 474--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">closure</span>))
                                                ((<span 
class="cmss-9">_</span><!--l. 475--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">int-val</span>))
                                                ((<span 
class="cmss-9">_</span><!--l. 476--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">list</span>))
                                                ((<span 
class="cmss-9">_</span><!--l. 477--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">quote</span>)))
 (<span 
class="cmss-9">absent closure </span><span 
class="cmss-9">_</span><!--l. 478--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>)
 (<span 
class="cmss-9">absent int-val </span><span 
class="cmss-9">_</span><!--l. 479--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>)
 (<span 
class="cmss-9">sym </span><span 
class="cmss-9">_</span><!--l. 480--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>))
 (((<span 
class="cmss-9">lambda </span>(<span 
class="cmss-9">_</span><!--l. 481--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>) (<span 
class="cmss-9">list </span>(<span 
class="cmss-9">list </span>’<span 
class="cmss-9">lambda </span>’(<span 
class="cmss-9">_</span><!--l. 481--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>) <span 
class="cmss-9">_</span><!--l. 481--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>) (<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span><span 
class="cmss-9">_</span><!--l. 481--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)))
  ’(<span 
class="cmss-9">list </span>(<span 
class="cmss-9">list </span>’<span 
class="cmss-9">lambda </span>’(<span 
class="cmss-9">_</span><!--l. 482--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>) <span 
class="cmss-9">_</span><!--l. 482--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>) (<span 
class="cmss-9">list </span>’<span 
class="cmss-9">quote </span><span 
class="cmss-9">_</span><!--l. 482--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)))
 (<!--l. 483--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel" stretchy="false">≢</mo></math> ((<span 
class="cmss-9">_</span><!--l. 483--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">closure</span>))
                                                ((<span 
class="cmss-9">_</span><!--l. 484--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">int-val</span>))
                                                ((<span 
class="cmss-9">_</span><!--l. 485--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">list</span>))
                                                ((<span 
class="cmss-9">_</span><!--l. 486--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmss-9">quote</span>)))
 (<span 
class="cmss-9">sym </span><span 
class="cmss-9">_</span><!--l. 487--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)))
</p><!--l. 492--><p class="noindent" >Not surprisingly, booleans are quines, since they are self-evaluating
literals. The other answers are more interesting—we encourage
the reader to look for patterns in the answers.
</p><!--l. 4--><p class="noindent" >
</p>
<h3 class="sectionHead"><span class="titlemark">B. </span> <a 
 id="x1-16000B"></a>A Relational Arithmetic System</h3>
<!--l. 6--><p class="noindent" >To make the paper self-contained, we present the relational
arithmetic system used in the extended interpreter of
appendix <a 
href="#x1-15000A">A<!--tex4ht:ref: extendedinterpreter --></a>. Variants of this arithmetic system have been
described in <span class="cite"><a 
href="#Xdeclarativearithmetic">Kiselyov et al.</a></span> (<span class="cite"><a 
href="#Xdeclarativearithmetic">2008</a></span>) (with termination proofs for
the individual operators), <span class="cite"><a 
href="#Xbyrdthesis">Byrd</a></span> (<span class="cite"><a 
href="#Xbyrdthesis">2009</a></span>), and <span class="cite"><a 
href="#Xreasoned">Friedman
et al.</a></span> (<span class="cite"><a 
href="#Xreasoned">2005</a></span>)—please see these references for a detailed       description of the code.
                                     </p><!--l. 14--><p class="indent" >  A  note  on  typography:
                                     <!--l. 15--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">+</mo></math><!--l. 15--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math>
                                     is  entered  as  <span 
class="cmtt-9">pluso</span>,
                                     <!--l. 18--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">−</mo></math><!--l. 18--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math>
                                     as <span 
class="cmtt-9">minuso</span>, <!--l. 20--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo><mi 
>o</mi></math>
                                     as <span 
class="cmtt-9">*o</span>, and <!--l. 23--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">÷</mo><mi 
>o</mi></math>
                                     as <span 
class="cmtt-9">/o</span>.
                                     </p><!--l. 26--><p class="noindent" >
                                     </p>
                                       <h4 class="subsectionHead"><span class="titlemark">B.1   </span> <a 
 id="x1-17000B.1"></a>Relational Arithmetic</h4>
                                     <!--l. 28--><p class="noindent" >Relational arithmetic allows for queries such
                                     as ‘what are five triples of natural numbers
                                     <!--l. 29--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>x</mi></math>,
                                     <!--l. 29--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>y</mi></math>, and
                                     <!--l. 29--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>z</mi></math> for which
                                     <!--l. 29--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>x</mi> <mo 
class="MathClass-bin" stretchy="false">+</mo> <mi 
>y</mi> <mo 
class="MathClass-rel" stretchy="false">=</mo> <mi 
>z</mi></math>?’, and ‘for which
                                     natural numbers <!--l. 30--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>x</mi></math>
                                     and <!--l. 30--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>y</mi></math>
                                     does <!--l. 30--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>x</mi> <mo 
class="MathClass-bin" stretchy="false">⋅</mo><mi 
>y</mi> <mo 
class="MathClass-rel" stretchy="false">=</mo> <mn>2</mn><mn>4</mn></math>
                                     hold?’, which can be expressed in miniKanren as
                                     (<span 
class="cmbx-9">run</span><!--l. 34--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="bold">5</mi></math> (<span 
class="cmti-9">q</span>)
                                      (<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">x y z</span>)
                                        (<!--l. 36--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">+</mo></math><!--l. 36--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> <span 
class="cmti-9">x y z</span>)
                                        (<!--l. 37--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">x </span>,<span 
class="cmti-9">y </span>,<span 
class="cmti-9">z</span>) <span 
class="cmti-9">q</span>)))
                                     </p><!--l. 40--><p class="noindent" >and
                                     (<span 
class="cmbx-9">run</span><!--l. 43--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo></math> (<span 
class="cmti-9">q</span>)
                                      (<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">x y</span>)
                                        (<!--l. 45--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo><mi 
>o</mi></math> <span 
class="cmti-9">x y </span>(<span 
class="cmti-9">build-num </span><span 
class="cmss-9">24</span>))
                                        (<!--l. 46--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">x </span>,<span 
class="cmti-9">y </span>,(<span 
class="cmti-9">build-num </span><span 
class="cmss-9">24</span>)) <span 
class="cmti-9">q</span>)))
                                     </p><!--l. 49--><p class="noindent" >respectively.
                                     </p><!--l. 51--><p class="indent" >  In order to understand the answers to these <span 
class="cmbx-9">run</span>s, it is
                                     necessary to know how we represent numbers. Ground numbers
                                     are represented in “little endian” style using lists of bits. The
                                     most significant bit in the list cannot be 0; this restriction
                                     ensures each number has a unique representation. Zero is
                                     therefore represented by the empty list rather than (<span 
class="cmss-9">0</span>), to avoid
                                     violating this restriction. The number one is represented by (<span 
class="cmss-9">1</span>),
                                     the number two by (<span 
class="cmss-9">0 1</span>), etc.
                                     </p><!--l. 69--><p class="indent" >  A number need not be ground, so long as it is not instantiated
                                     to a list ending with 0. For example, ‘(<span 
class="cmss-9">1 </span>. ,<span 
class="cmti-9">x</span>) represents any odd
                                     natural number, while ‘(<span 
class="cmss-9">0 </span>. ,<span 
class="cmti-9">x</span>) represents any <span 
class="cmti-9">positive</span>
                                     even number (with the restriction that <span 
class="cmti-9">x </span>must represent a
                                     positive integer, which we shall assume in the rest of this
                                     description). The list (<span 
class="cmss-9">0 0 0 1</span>) represents the number 8, while
                                     ‘(<span 
class="cmss-9">0 0 0 </span>. ,<span 
class="cmti-9">x</span>) represents multiples of 8. If <span 
class="cmti-9">x </span>is (<span 
class="cmss-9">1</span>), the multiple is
                                     just 8. If <span 
class="cmti-9">x </span>is (<span 
class="cmss-9">0 1</span>), the multiple of 8 is 16, and so forth.
                                     Numbers can be even more sophisticated: ‘(<span 
class="cmss-9">0 </span>,<span 
class="cmti-9">y </span><span 
class="cmss-9">0 </span>. ,<span 
class="cmti-9">x</span>)
                                     represents multiples of 8 if <span 
class="cmti-9">y </span>is 0, and numbers of the form
                                     <!--l. 102--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>8</mn><mi 
>x</mi> <mo 
class="MathClass-bin" stretchy="false">+</mo> <mn>2</mn></math> if <span 
class="cmti-9">y</span>
                                     is 1.
                                     </p><!--l. 106--><p class="indent" >  Here are the answers to the
                                     <span 
class="cmbx-9">run</span><!--l. 107--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="bold">5</mi></math>
                                     expression above. The first answer states that for
                                     <!--l. 109--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>x</mi> <mo 
class="MathClass-rel" stretchy="false">≥</mo> <mn>0</mn></math>,
                                     <!--l. 109--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>x</mi> <mo 
class="MathClass-bin" stretchy="false">+</mo> <mn>0</mn> <mo 
class="MathClass-rel" stretchy="false">=</mo> <mi 
>x</mi></math>; the second answer
                                     states that for <!--l. 110--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>x</mi> <mo 
class="MathClass-rel" stretchy="false">&#x003E;</mo> <mn>0</mn></math>,
                                     <!--l. 110--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>0</mn> <mo 
class="MathClass-bin" stretchy="false">+</mo> <mi 
>x</mi> <mo 
class="MathClass-rel" stretchy="false">=</mo> <mi 
>x</mi></math>; the third answer
                                     states that <!--l. 110--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>1</mn> <mo 
class="MathClass-bin" stretchy="false">+</mo> <mn>1</mn> <mo 
class="MathClass-rel" stretchy="false">=</mo> <mn>2</mn></math>; the fourth
                                     answer states that for <!--l. 111--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>x</mi> <mo 
class="MathClass-rel" stretchy="false">&#x003E;</mo> <mn>0</mn></math>
                                     and <!--l. 111--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>y</mi> <mo 
class="MathClass-rel" stretchy="false">≤</mo> <mn>1</mn></math>,
                                     <!--l. 111--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>1</mn> <mo 
class="MathClass-bin" stretchy="false">+</mo> <mo 
class="MathClass-open" stretchy="false">(</mo><mn>4</mn><mi 
>x</mi> <mo 
class="MathClass-bin" stretchy="false">+</mo> <mi 
>y</mi><mo 
class="MathClass-close" stretchy="false">)</mo> <mo 
class="MathClass-rel" stretchy="false">=</mo> <mn>4</mn><mi 
>x</mi> <mo 
class="MathClass-bin" stretchy="false">+</mo> <mi 
>y</mi> <mo 
class="MathClass-bin" stretchy="false">+</mo> <mn>1</mn></math>; and the fifth

answer states that <!--l. 112--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>1</mn> <mo 
class="MathClass-bin" stretchy="false">+</mo> <mn>3</mn> <mo 
class="MathClass-rel" stretchy="false">=</mo> <mn>4</mn></math>.
</p><!--l. 116--><p class="indent" >((<span 
class="cmss-9">_</span><!--l. 117--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn> </mrow> </msub 
> </mrow> </msub 
> </math> () <span 
class="cmss-9">_</span><!--l. 117--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math>)
   (() (<span 
class="cmss-9">_</span><!--l. 118--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> . <span 
class="cmss-9">_</span><!--l. 118--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>) (<span 
class="cmss-9">_</span><!--l. 118--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> . <span 
class="cmss-9">_</span><!--l. 118--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>))
   ((<span 
class="cmss-9">1</span>) (<span 
class="cmss-9">1</span>) (<span 
class="cmss-9">0 1</span>))
   ((<span 
class="cmss-9">1</span>) (<span 
class="cmss-9">0 </span><span 
class="cmss-9">_</span><!--l. 120--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> . <span 
class="cmss-9">_</span><!--l. 120--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>) (<span 
class="cmss-9">1 </span><span 
class="cmss-9">_</span><!--l. 120--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> . <span 
class="cmss-9">_</span><!--l. 120--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>))
   ((<span 
class="cmss-9">1</span>) (<span 
class="cmss-9">1 1</span>) (<span 
class="cmss-9">0 0 1</span>)))
</p><!--l. 126--><p class="indent" >And here are the answers to the
<span 
class="cmbx-9">run</span><!--l. 127--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo> </math>
expression above. There are eight answers, each one producing a
different way to multiply two numbers to yield 24. For example,
the fifth answer states that 8 times 3 is 24.
</p><!--l. 135--><p class="indent" >(((<span 
class="cmss-9">1</span>) (<span 
class="cmss-9">0 0 0 1 1</span>) (<span 
class="cmss-9">0 0 0 1 1</span>))
   ((<span 
class="cmss-9">0 0 0 1 1</span>) (<span 
class="cmss-9">1</span>) (<span 
class="cmss-9">0 0 0 1 1</span>))
   ((<span 
class="cmss-9">0 1</span>) (<span 
class="cmss-9">0 0 1 1</span>) (<span 
class="cmss-9">0 0 0 1 1</span>))
   ((<span 
class="cmss-9">0 0 1</span>) (<span 
class="cmss-9">0 1 1</span>) (<span 
class="cmss-9">0 0 0 1 1</span>))
   ((<span 
class="cmss-9">0 0 0 1</span>) (<span 
class="cmss-9">1 1</span>) (<span 
class="cmss-9">0 0 0 1 1</span>))
   ((<span 
class="cmss-9">1 1</span>) (<span 
class="cmss-9">0 0 0 1</span>) (<span 
class="cmss-9">0 0 0 1 1</span>))
   ((<span 
class="cmss-9">0 1 1</span>) (<span 
class="cmss-9">0 0 1</span>) (<span 
class="cmss-9">0 0 0 1 1</span>))
   ((<span 
class="cmss-9">0 0 1 1</span>) (<span 
class="cmss-9">0 1</span>) (<span 
class="cmss-9">0 0 0 1 1</span>)))
</p><!--l. 162--><p class="indent" >Our system includes other relational arithmetic operators: subtraction
(<!--l. 163--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">−</mo></math><!--l. 163--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math>),
integer division with remainder
(<!--l. 166--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">÷</mo><mi 
>o</mi> </math>),
integer logarithm with remainder
(<!--l. 168--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>l</mi><mi 
>o</mi><mi 
>g</mi><mi 
>o</mi> </math>), and exponentiation
(<!--l. 170--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi><mi 
>x</mi><mi 
>p</mi><mi 
>o</mi> </math>, which is
derived from <!--l. 172--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>l</mi><mi 
>o</mi><mi 
>g</mi><mi 
>o</mi></math>).
</p><!--l. 178--><p class="noindent" >
</p>
<h4 class="subsectionHead"><span class="titlemark">B.2 </span> <a 
 id="x1-18000B.2"></a>Core Arithmetic Operators</h4>
<!--l. 180--><p class="noindent" >This subsection contains arithmetic operators used in the
extended interpreter in appendix <a 
href="#x1-15000A">A<!--tex4ht:ref: extendedinterpreter --></a>.
</p><!--l. 183--><p class="indent" >                                     (<span 
class="cmbx-9">define </span><span 
class="cmti-9">build-num</span>
                                      (<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">n</span>)
                                        (<span 
class="cmbx-9">cond</span>
                                          ((<span 
class="cmti-9">odd? n</span>)
                                           (<span 
class="cmti-9">cons </span><span 
class="cmss-9">1</span>
                                            (<span 
class="cmti-9">build-num </span>(<!--l. 191--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">÷</mo></math> (<!--l. 191--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">−</mo></math><span 
class="cmti-9">n </span><span 
class="cmss-9">1</span>) <span 
class="cmss-9">2</span>))))
                                          ((<span 
class="cmbx-9">and </span>(<span 
class="cmti-9">not </span>(<span 
class="cmti-9">zero? n</span>)) (<span 
class="cmti-9">even? n</span>))
                                           (<span 
class="cmti-9">cons </span><span 
class="cmss-9">0</span>
                                            (<span 
class="cmti-9">build-num </span>(<!--l. 194--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">÷</mo></math><span 
class="cmti-9">n </span><span 
class="cmss-9">2</span>))))
                                          ((<span 
class="cmti-9">zero? n</span>) ’()))))
                                     (<span 
class="cmbx-9">define </span><span 
class="cmti-9">zero</span><!--l. 199--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                      (<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">n</span>)
                                        (<!--l. 201--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">n</span>)))
                                     (<span 
class="cmbx-9">define </span><span 
class="cmti-9">pos</span><!--l. 205--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                      (<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">n</span>)
                                        (<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">a d</span>)
                                          (<!--l. 208--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">a </span>. ,<span 
class="cmti-9">d</span>) <span 
class="cmti-9">n</span>))))
                                     (<span 
class="cmbx-9">define </span><!--l. 212--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">&#x003E;</mo> <mspace width="-0.17em" class="negthinspace"/></math><span 
class="cmbx-9">1</span><!--l. 212--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math>
                                      (<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">n</span>)
                                        (<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">a ad dd</span>)
                                          (<!--l. 215--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">a </span>,<span 
class="cmti-9">ad </span>. ,<span 
class="cmti-9">dd</span>) <span 
class="cmti-9">n</span>))))
                                     (<span 
class="cmbx-9">define </span><span 
class="cmti-9">full-adder</span><!--l. 219--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                      (<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">b x y r c</span>)
                                        (<span 
class="cmbx-9">cond</span><!--l. 221--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>
                                          ((<!--l. 222--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">0 </span><span 
class="cmti-9">b</span>) (<!--l. 222--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">0 </span><span 
class="cmti-9">x</span>) (<!--l. 222--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">0 </span><span 
class="cmti-9">y</span>) (<!--l. 222--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">0 </span><span 
class="cmti-9">r</span>) (<!--l. 222--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">0 </span><span 
class="cmti-9">c</span>))
                                          ((<!--l. 223--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">1 </span><span 
class="cmti-9">b</span>) (<!--l. 223--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">0 </span><span 
class="cmti-9">x</span>) (<!--l. 223--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">0 </span><span 
class="cmti-9">y</span>) (<!--l. 223--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">1 </span><span 
class="cmti-9">r</span>) (<!--l. 223--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">0 </span><span 
class="cmti-9">c</span>))
                                          ((<!--l. 224--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">0 </span><span 
class="cmti-9">b</span>) (<!--l. 224--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">1 </span><span 
class="cmti-9">x</span>) (<!--l. 224--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">0 </span><span 
class="cmti-9">y</span>) (<!--l. 224--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">1 </span><span 
class="cmti-9">r</span>) (<!--l. 224--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">0 </span><span 
class="cmti-9">c</span>))
                                          ((<!--l. 225--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">1 </span><span 
class="cmti-9">b</span>) (<!--l. 225--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">1 </span><span 
class="cmti-9">x</span>) (<!--l. 225--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">0 </span><span 
class="cmti-9">y</span>) (<!--l. 225--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">0 </span><span 
class="cmti-9">r</span>) (<!--l. 225--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">1 </span><span 
class="cmti-9">c</span>))
                                          ((<!--l. 226--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">0 </span><span 
class="cmti-9">b</span>) (<!--l. 226--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">0 </span><span 
class="cmti-9">x</span>) (<!--l. 226--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">1 </span><span 
class="cmti-9">y</span>) (<!--l. 226--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">1 </span><span 
class="cmti-9">r</span>) (<!--l. 226--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">0 </span><span 
class="cmti-9">c</span>))
                                          ((<!--l. 227--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">1 </span><span 
class="cmti-9">b</span>) (<!--l. 227--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">0 </span><span 
class="cmti-9">x</span>) (<!--l. 227--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">1 </span><span 
class="cmti-9">y</span>) (<!--l. 227--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">0 </span><span 
class="cmti-9">r</span>) (<!--l. 227--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">1 </span><span 
class="cmti-9">c</span>))
                                          ((<!--l. 228--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">0 </span><span 
class="cmti-9">b</span>) (<!--l. 228--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">1 </span><span 
class="cmti-9">x</span>) (<!--l. 228--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">1 </span><span 
class="cmti-9">y</span>) (<!--l. 228--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">0 </span><span 
class="cmti-9">r</span>) (<!--l. 228--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">1 </span><span 
class="cmti-9">c</span>))
                                          ((<!--l. 229--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">1 </span><span 
class="cmti-9">b</span>) (<!--l. 229--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">1 </span><span 
class="cmti-9">x</span>) (<!--l. 229--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">1 </span><span 
class="cmti-9">y</span>) (<!--l. 229--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">1 </span><span 
class="cmti-9">r</span>) (<!--l. 229--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">1 </span><span 
class="cmti-9">c</span>)))))
                                     (<span 
class="cmbx-9">define </span><span 
class="cmti-9">adder</span><!--l. 233--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                      (<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">d n m r</span>)
                                        (<span 
class="cmbx-9">cond</span><!--l. 235--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>
                                          ((<!--l. 236--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">0 </span><span 
class="cmti-9">d</span>) (<!--l. 236--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">m</span>) (<!--l. 236--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmti-9">n r</span>))
                                          ((<!--l. 237--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">0 </span><span 
class="cmti-9">d</span>) (<!--l. 237--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">n</span>) (<!--l. 237--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmti-9">m r</span>)
                                           (<span 
class="cmti-9">pos</span><!--l. 238--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">m</span>))
                                          ((<!--l. 239--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">1 </span><span 
class="cmti-9">d</span>) (<!--l. 239--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">m</span>)
                                           (<span 
class="cmti-9">adder</span><!--l. 240--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmss-9">0 </span><span 
class="cmti-9">n </span>’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">r</span>))
                                          ((<!--l. 241--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmss-9">1 </span><span 
class="cmti-9">d</span>) (<!--l. 241--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">n</span>) (<span 
class="cmti-9">pos</span><!--l. 241--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">m</span>)
                                           (<span 
class="cmti-9">adder</span><!--l. 242--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmss-9">0 </span>’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">m r</span>))
                                          ((<!--l. 243--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">n</span>) (<!--l. 243--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">m</span>)
                                           (<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">a c</span>)
                                            (<!--l. 245--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">a </span>,<span 
class="cmti-9">c</span>) <span 
class="cmti-9">r</span>)
                                            (<span 
class="cmti-9">full-adder</span><!--l. 246--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">d </span><span 
class="cmss-9">1 1 </span><span 
class="cmti-9">a c</span>)))
                                          ((<!--l. 247--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">n</span>) (<span 
class="cmti-9">gen-adder</span><!--l. 247--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">d n m r</span>))
                                          ((<!--l. 248--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">m</span>) (<!--l. 248--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">&#x003E;</mo> <mspace width="-0.17em" class="negthinspace"/></math><span 
class="cmbx-9">1</span><!--l. 248--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> <span 
class="cmti-9">n</span>) (<!--l. 248--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">&#x003E;</mo> <mspace width="-0.17em" class="negthinspace"/></math><span 
class="cmbx-9">1</span><!--l. 248--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> <span 
class="cmti-9">r</span>)
                                           (<span 
class="cmti-9">adder</span><!--l. 249--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">d </span>’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">n r</span>))
                                          ((<!--l. 250--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">&#x003E;</mo> <mspace width="-0.17em" class="negthinspace"/></math><span 
class="cmbx-9">1</span><!--l. 250--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> <span 
class="cmti-9">n</span>) (<span 
class="cmti-9">gen-adder</span><!--l. 250--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">d n m r</span>)))))
                                     (<span 
class="cmbx-9">define </span><span 
class="cmti-9">gen-adder</span><!--l. 254--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                      (<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">d n m r</span>)
                                        (<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">a b c e x y z</span>)
                                          (<!--l. 257--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">a </span>. ,<span 
class="cmti-9">x</span>) <span 
class="cmti-9">n</span>)
                                          (<!--l. 258--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">b </span>. ,<span 
class="cmti-9">y</span>) <span 
class="cmti-9">m</span>) (<span 
class="cmti-9">pos</span><!--l. 258--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">y</span>)
                                          (<!--l. 259--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">c </span>. ,<span 
class="cmti-9">z</span>) <span 
class="cmti-9">r</span>) (<span 
class="cmti-9">pos</span><!--l. 259--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">z</span>)
                                          (<span 
class="cmti-9">full-adder</span><!--l. 260--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">d a b c e</span>)
                                          (<span 
class="cmti-9">adder</span><!--l. 261--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">e x y z</span>))))
                                     (<span 
class="cmbx-9">define </span><!--l. 265--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">+</mo></math><!--l. 265--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> (<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">n m k</span>) (<span 
class="cmti-9">adder</span><!--l. 265--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmss-9">0 </span><span 
class="cmti-9">n m k</span>)))
                                     (<span 
class="cmbx-9">define </span><!--l. 269--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">−</mo></math><!--l. 269--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> (<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">n m k</span>) (<!--l. 269--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">+</mo></math><!--l. 269--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> <span 
class="cmti-9">m k n</span>)))

(<span 
class="cmbx-9">define </span><!--l. 273--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo><mi 
>o</mi> </math>
(<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">n m p</span>)
(<span 
class="cmbx-9">cond</span><!--l. 275--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi> </math>
((<!--l. 276--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">n</span>) (<!--l. 276--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">p</span>))
((<span 
class="cmti-9">pos</span><!--l. 277--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math> <span 
class="cmti-9">n</span>) (<!--l. 277--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">m</span>) (<!--l. 277--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">p</span>))
((<!--l. 278--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">n</span>) (<span 
class="cmti-9">pos</span><!--l. 278--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">m</span>) (<!--l. 278--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmti-9">m p</span>))
((<!--l. 279--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">&#x003E;</mo> <mspace width="-0.17em" class="negthinspace"/> </math><span 
class="cmbx-9">1</span><!--l. 279--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> <span 
class="cmti-9">n</span>) (<!--l. 279--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">m</span>) (<!--l. 279--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmti-9">n p</span>))
((<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">x z</span>)
(<!--l. 281--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">0 </span>. ,<span 
class="cmti-9">x</span>) <span 
class="cmti-9">n</span>) (<span 
class="cmti-9">pos</span><!--l. 281--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">x</span>)
(<!--l. 282--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">0 </span>. ,<span 
class="cmti-9">z</span>) <span 
class="cmti-9">p</span>) (<span 
class="cmti-9">pos</span><!--l. 282--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">z</span>)
(<!--l. 283--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">&#x003E;</mo> <mspace width="-0.17em" class="negthinspace"/> </math><span 
class="cmbx-9">1</span><!--l. 283--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> <span 
class="cmti-9">m</span>)
(<!--l. 284--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo><mi 
>o</mi> </math> <span 
class="cmti-9">x m z</span>)))
((<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">x y</span>)
(<!--l. 286--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">1 </span>. ,<span 
class="cmti-9">x</span>) <span 
class="cmti-9">n</span>) (<span 
class="cmti-9">pos</span><!--l. 286--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">x</span>)
(<!--l. 287--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">0 </span>. ,<span 
class="cmti-9">y</span>) <span 
class="cmti-9">m</span>) (<span 
class="cmti-9">pos</span><!--l. 287--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">y</span>)
(<!--l. 288--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo><mi 
>o</mi> </math> <span 
class="cmti-9">m n p</span>)))
((<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">x y</span>)
(<!--l. 290--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">1 </span>. ,<span 
class="cmti-9">x</span>) <span 
class="cmti-9">n</span>) (<span 
class="cmti-9">pos</span><!--l. 290--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">x</span>)
(<!--l. 291--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">1 </span>. ,<span 
class="cmti-9">y</span>) <span 
class="cmti-9">m</span>) (<span 
class="cmti-9">pos</span><!--l. 291--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">y</span>)
(<span 
class="cmti-9">odd-</span><!--l. 292--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo><mi 
>o</mi></math> <span 
class="cmti-9">x n m p</span>))))))
(<span 
class="cmbx-9">define </span><span 
class="cmti-9">odd-</span><!--l. 296--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo><mi 
>o</mi> </math>
(<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">x n m p</span>)
(<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">q</span>)
(<span 
class="cmti-9">bound-</span><!--l. 299--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo><mi 
>o</mi></math> <span 
class="cmti-9">q p n m</span>)
(<!--l. 300--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo><mi 
>o</mi> </math> <span 
class="cmti-9">x m q</span>)
(<!--l. 301--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">+</mo></math><!--l. 301--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> ‘(<span 
class="cmss-9">0 </span>. ,<span 
class="cmti-9">q</span>) <span 
class="cmti-9">m p</span>))))
(<span 
class="cmbx-9">define </span><span 
class="cmti-9">bound-</span><!--l. 305--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo><mi 
>o</mi></math>
(<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">q p n m</span>)
(<span 
class="cmbx-9">cond</span><!--l. 307--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi> </math>
((<!--l. 308--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">q</span>) (<span 
class="cmti-9">pos</span><!--l. 308--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">p</span>))
((<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">a</span><!--l. 309--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">a</span><!--l. 309--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">a</span><!--l. 309--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">a</span><!--l. 309--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>3</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">x y z</span>)
(<!--l. 310--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">a</span><!--l. 310--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></msub 
></math> . ,<span 
class="cmti-9">x</span>) <span 
class="cmti-9">q</span>)
(<!--l. 311--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">a</span><!--l. 311--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math> . ,<span 
class="cmti-9">y</span>) <span 
class="cmti-9">p</span>)
(<span 
class="cmbx-9">cond</span><!--l. 312--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>
((<!--l. 313--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">n</span>) (<!--l. 313--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">a</span><!--l. 313--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow></msub 
></math> . ,<span 
class="cmti-9">z</span>) <span 
class="cmti-9">m</span>)
(<span 
class="cmti-9">bound-</span><!--l. 314--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo><mi 
>o</mi></math> <span 
class="cmti-9">x y z </span>’()))
((<!--l. 315--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">a</span><!--l. 315--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>3</mn></mrow></msub 
></mrow></msub 
></math> . ,<span 
class="cmti-9">z</span>) <span 
class="cmti-9">n</span>) (<span 
class="cmti-9">bound-</span><!--l. 315--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo><mi 
>o</mi></math> <span 
class="cmti-9">x y z m</span>))))))))
</p>
<h4 class="subsectionHead"><span class="titlemark">B.3 </span> <a 
 id="x1-19000B.3"></a>Additional Arithmetic Operators</h4>
<!--l. 321--><p class="noindent" >This subsection contains useful arithmetic operators, beyond
those used in the extended interpreter in appendix <a 
href="#x1-15000A">A<!--tex4ht:ref: extendedinterpreter --></a>.
(<span 
class="cmbx-9">define </span><!--l. 325--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">=</mo></math><span 
class="cmti-9">l</span><!--l. 325--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
(<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">n m</span>)
(<span 
class="cmbx-9">cond</span><!--l. 327--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi> </math>
((<!--l. 328--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">n</span>) (<!--l. 328--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">m</span>))
((<!--l. 329--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">n</span>) (<!--l. 329--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">m</span>))
((<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">a x b y</span>)
(<!--l. 331--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">a </span>. ,<span 
class="cmti-9">x</span>) <span 
class="cmti-9">n</span>) (<span 
class="cmti-9">pos</span><!--l. 331--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">x</span>)
(<!--l. 332--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">b </span>. ,<span 
class="cmti-9">y</span>) <span 
class="cmti-9">m</span>) (<span 
class="cmti-9">pos</span><!--l. 332--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">y</span>)
(<!--l. 333--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">=</mo></math><span 
class="cmti-9">l</span><!--l. 333--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">x y</span>))))))
(<span 
class="cmbx-9">define </span><!--l. 337--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">&#x003C;</mo></math><span 
class="cmti-9">l</span><!--l. 337--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
(<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">n m</span>)
(<span 
class="cmbx-9">cond</span><!--l. 339--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi> </math>
((<!--l. 340--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">n</span>) (<span 
class="cmti-9">pos</span><!--l. 340--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">m</span>))
((<!--l. 341--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">n</span>) (<!--l. 341--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">&#x003E;</mo> <mspace width="-0.17em" class="negthinspace"/></math><span 
class="cmbx-9">1</span><!--l. 341--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> <span 
class="cmti-9">m</span>))
((<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">a x b y</span>)
(<!--l. 343--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">a </span>. ,<span 
class="cmti-9">x</span>) <span 
class="cmti-9">n</span>) (<span 
class="cmti-9">pos</span><!--l. 343--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">x</span>)
(<!--l. 344--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">b </span>. ,<span 
class="cmti-9">y</span>) <span 
class="cmti-9">m</span>) (<span 
class="cmti-9">pos</span><!--l. 344--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">y</span>)
(<!--l. 345--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">&#x003C;</mo></math><span 
class="cmti-9">l</span><!--l. 345--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">x y</span>))))))
(<span 
class="cmbx-9">define </span><!--l. 349--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≤</mo></math><span 
class="cmti-9">l</span><!--l. 349--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
(<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">n m</span>)
(<span 
class="cmbx-9">cond</span><!--l. 351--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi> </math>  ((<!--l. 352--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">=</mo></math><span 
class="cmti-9">l</span><!--l. 352--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">n m</span>))
                                          ((<!--l. 353--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">&#x003C;</mo></math><span 
class="cmti-9">l</span><!--l. 353--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">n m</span>)))))
                                     (<span 
class="cmbx-9">define </span><!--l. 357--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">&#x003C;</mo><mi 
>o</mi></math>
                                      (<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">n m</span>)
                                        (<span 
class="cmbx-9">cond</span><!--l. 359--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>
                                          ((<!--l. 360--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">&#x003C;</mo></math><span 
class="cmti-9">l</span><!--l. 360--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">n m</span>))
                                          ((<!--l. 361--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">=</mo></math><span 
class="cmti-9">l</span><!--l. 361--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">n m</span>)
                                           (<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">x</span>)
                                            (<span 
class="cmti-9">pos</span><!--l. 363--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">x</span>)
                                            (<!--l. 364--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">+</mo></math><!--l. 364--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> <span 
class="cmti-9">n x m</span>))))))
                                     (<span 
class="cmbx-9">define </span><!--l. 368--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≤</mo><mi 
>o</mi></math>
                                      (<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">n m</span>)
                                        (<span 
class="cmbx-9">cond</span><!--l. 370--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>
                                          ((<!--l. 371--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmti-9">n m</span>))
                                          ((<!--l. 372--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">&#x003C;</mo><mi 
>o</mi></math> <span 
class="cmti-9">n m</span>)))))
                                     (<span 
class="cmbx-9">define </span><!--l. 376--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">÷</mo><mi 
>o</mi></math>
                                      (<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">n m q r</span>)
                                        (<span 
class="cmbx-9">cond</span><!--l. 378--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>
                                          ((<!--l. 379--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmti-9">r n</span>) (<!--l. 379--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">q</span>) (<!--l. 379--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">&#x003C;</mo><mi 
>o</mi></math> <span 
class="cmti-9">n m</span>))
                                          ((<!--l. 380--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">q</span>) (<!--l. 380--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">=</mo></math><span 
class="cmti-9">l</span><!--l. 380--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">n m</span>) (<!--l. 380--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">+</mo></math><!--l. 380--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> <span 
class="cmti-9">r m n</span>) (<!--l. 380--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">&#x003C;</mo><mi 
>o</mi></math> <span 
class="cmti-9">r m</span>))
                                          ((<!--l. 381--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">&#x003C;</mo></math><span 
class="cmti-9">l</span><!--l. 381--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">m n</span>) (<!--l. 381--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">&#x003C;</mo><mi 
>o</mi></math> <span 
class="cmti-9">r m</span>) (<span 
class="cmti-9">pos</span><!--l. 381--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">q</span>)
                                           (<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">n</span><!--l. 382--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>h</mi></math> <span 
class="cmti-9">n</span><!--l. 382--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>l</mi></math> <span 
class="cmti-9">q</span><!--l. 382--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>h</mi></math> <span 
class="cmti-9">q</span><!--l. 382--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>l</mi></math> <span 
class="cmti-9">qlm qlmr rr r</span><!--l. 382--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>h</mi></math>)
                                            (<span 
class="cmti-9">split</span><!--l. 383--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">n r n</span><!--l. 383--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" >
<mi 
>l</mi></math> <span 
class="cmti-9">n</span><!--l. 383--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>h</mi></math>)
                                            (<span 
class="cmti-9">split</span><!--l. 384--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">q r q</span><!--l. 384--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" >
<mi 
>l</mi></math> <span 
class="cmti-9">q</span><!--l. 384--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>h</mi></math>)
                                            (<span 
class="cmbx-9">cond</span><!--l. 385--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>
                                              ((<!--l. 386--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">n</span><!--l. 386--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>h</mi></math>) (<!--l. 386--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">q</span><!--l. 386--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>h</mi></math>)
                                               (<!--l. 387--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">−</mo></math><!--l. 387--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> <span 
class="cmti-9">n</span><!--l. 387--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" >
<mi 
>l</mi></math> <span 
class="cmti-9">r qlm</span>)
                                               (<!--l. 388--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo><mi 
>o</mi></math> <span 
class="cmti-9">q</span><!--l. 388--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" >
<mi 
>l</mi></math> <span 
class="cmti-9">m qlm</span>))
                                              ((<span 
class="cmti-9">pos</span><!--l. 389--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">n</span><!--l. 389--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" >
<mi 
>h</mi></math>)
                                               (<!--l. 390--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo><mi 
>o</mi></math> <span 
class="cmti-9">q</span><!--l. 390--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" >
<mi 
>l</mi></math> <span 
class="cmti-9">m qlm</span>)
                                               (<!--l. 391--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">+</mo></math><!--l. 391--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> <span 
class="cmti-9">qlm r qlmr</span>)
                                               (<!--l. 392--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">−</mo></math><!--l. 392--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> <span 
class="cmti-9">qlmr n</span><!--l. 392--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" >
<mi 
>l</mi></math> <span 
class="cmti-9">rr</span>)
                                               (<span 
class="cmti-9">split</span><!--l. 393--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">rr r </span>’() <span 
class="cmti-9">r</span><!--l. 393--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" >
<mi 
>h</mi></math>)
                                               (<!--l. 394--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">÷</mo><mi 
>o</mi></math> <span 
class="cmti-9">n</span><!--l. 394--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" >
<mi 
>h</mi></math> <span 
class="cmti-9">m q</span><!--l. 394--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>h</mi></math> <span 
class="cmti-9">r</span><!--l. 394--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>h</mi></math>))))))))
                                     (<span 
class="cmbx-9">define </span><span 
class="cmti-9">split</span><!--l. 398--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                      (<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">n r l h</span>)
                                        (<span 
class="cmbx-9">cond</span><!--l. 400--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>
                                          ((<!--l. 401--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">n</span>) (<!--l. 401--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">h</span>) (<!--l. 401--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">l</span>))
                                          ((<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">b </span><!--l. 402--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>n</mi></mrow><mo accent="true">^</mo></mover></math>)
                                            (<!--l. 403--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">0 </span>,<span 
class="cmti-9">b </span>. ,<!--l. 403--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>n</mi></mrow><mo accent="true">^</mo></mover></math>) <span 
class="cmti-9">n</span>)
                                            (<!--l. 404--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">r</span>)
                                            (<!--l. 405--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">b </span>. ,<!--l. 405--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>n</mi></mrow><mo accent="true">^</mo></mover></math>) <span 
class="cmti-9">h</span>)
                                            (<!--l. 406--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">l</span>)))
                                          ((<span 
class="cmbx-9">fresh </span>(<!--l. 407--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>n</mi></mrow><mo accent="true">^</mo></mover></math>)
                                            (<!--l. 408--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmti-9"> </span>‘(<span 
class="cmss-9">1 </span>. ,<!--l. 408--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>n</mi></mrow><mo accent="true">^</mo></mover></math>) <span 
class="cmti-9">n</span>)
                                            (<!--l. 409--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">r</span>)
                                            (<!--l. 410--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><!--l. 410--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>n</mi></mrow><mo accent="true">^</mo></mover></math> <span 
class="cmti-9">h</span>)
                                            (<!--l. 411--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">l</span>)))
                                          ((<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">b </span><!--l. 412--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>n</mi></mrow><mo accent="true">^</mo></mover></math> <span 
class="cmti-9">a </span><!--l. 412--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>r</mi></mrow><mo accent="true">^</mo></mover></math>)
                                            (<!--l. 413--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">0 </span>,<span 
class="cmti-9">b </span>. ,<!--l. 413--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>n</mi></mrow><mo accent="true">^</mo></mover></math>) <span 
class="cmti-9">n</span>)
                                            (<!--l. 414--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">a </span>. ,<!--l. 414--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>r</mi></mrow><mo accent="true">^</mo></mover></math>) <span 
class="cmti-9">r</span>)
                                            (<!--l. 415--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">l</span>)
                                            (<span 
class="cmti-9">split</span><!--l. 416--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> ‘(,<span 
class="cmti-9">b </span>. ,<!--l. 416--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>n</mi></mrow><mo accent="true">^</mo></mover></math>) <!--l. 416--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>r</mi></mrow><mo accent="true">^</mo></mover></math> ’() <span 
class="cmti-9">h</span>)))
                                          ((<span 
class="cmbx-9">fresh </span>(<!--l. 417--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>n</mi></mrow><mo accent="true">^</mo></mover></math> <span 
class="cmti-9">a </span><!--l. 417--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>r</mi></mrow><mo accent="true">^</mo></mover></math>)
                                            (<!--l. 418--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">1 </span>. ,<!--l. 418--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>n</mi></mrow><mo accent="true">^</mo></mover></math>) <span 
class="cmti-9">n</span>)
                                            (<!--l. 419--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">a </span>. ,<!--l. 419--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>r</mi></mrow><mo accent="true">^</mo></mover></math>) <span 
class="cmti-9">r</span>)
                                            (<!--l. 420--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">l</span>)
                                            (<span 
class="cmti-9">split</span><!--l. 421--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <!--l. 421--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>n</mi></mrow><mo accent="true">^</mo></mover></math> <!--l. 421--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>r</mi></mrow><mo accent="true">^</mo></mover></math> ’() <span 
class="cmti-9">h</span>)))
                                          ((<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">b </span><!--l. 422--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>n</mi></mrow><mo accent="true">^</mo></mover></math> <span 
class="cmti-9">a </span><!--l. 422--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>r</mi></mrow><mo accent="true">^</mo></mover></math> <!--l. 422--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>l</mi></mrow><mo accent="true">^</mo></mover></math>)
                                            (<!--l. 423--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">b </span>. ,<!--l. 423--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>n</mi></mrow><mo accent="true">^</mo></mover></math>) <span 
class="cmti-9">n</span>)
                                            (<!--l. 424--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">a </span>. ,<!--l. 424--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>r</mi></mrow><mo accent="true">^</mo></mover></math>) <span 
class="cmti-9">r</span>)
                                            (<!--l. 425--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">b </span>. ,<!--l. 425--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>l</mi></mrow><mo accent="true">^</mo></mover></math>) <span 
class="cmti-9">l</span>)
                                            (<span 
class="cmti-9">pos</span><!--l. 426--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <!--l. 426--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>l</mi></mrow><mo accent="true">^</mo></mover></math>)

(<span 
class="cmti-9">split</span><!--l. 427--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <!--l. 427--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>n</mi></mrow><mo accent="true">^</mo></mover></math> <!--l. 427--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>r</mi></mrow><mo accent="true">^</mo></mover></math> <!--l. 427--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>l</mi></mrow><mo accent="true">^</mo></mover></math> <span 
class="cmti-9">h</span>))))))
</p><!--l. 429--><p class="noindent" >                                     (<span 
class="cmbx-9">define </span><!--l. 431--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>l</mi><mi 
>o</mi><mi 
>g</mi><mi 
>o</mi></math>
                                      (<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">n b q r</span>)
                                        (<span 
class="cmbx-9">cond</span><!--l. 433--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>
                                          ((<!--l. 434--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">n</span>) (<span 
class="cmti-9">pos</span><!--l. 434--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">b</span>) (<!--l. 434--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">q</span>) (<!--l. 434--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">r</span>))
                                          ((<!--l. 435--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">q</span>) (<!--l. 435--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">&#x003C;</mo><mi 
>o</mi></math> <span 
class="cmti-9">n b</span>) (<!--l. 435--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">+</mo></math><!--l. 435--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> <span 
class="cmti-9">r </span>’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">n</span>))
                                          ((<!--l. 436--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">q</span>) (<!--l. 436--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">&#x003E;</mo> <mspace width="-0.17em" class="negthinspace"/></math><span 
class="cmbx-9">1</span><!--l. 436--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> <span 
class="cmti-9">b</span>) (<!--l. 436--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">=</mo></math><span 
class="cmti-9">l</span><!--l. 436--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">n b</span>) (<!--l. 436--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">+</mo></math><!--l. 436--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> <span 
class="cmti-9">r b n</span>))
                                          ((<!--l. 437--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">b</span>) (<span 
class="cmti-9">pos</span><!--l. 437--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">q</span>) (<!--l. 437--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">+</mo></math><!--l. 437--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> <span 
class="cmti-9">r </span>’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">n</span>))
                                          ((<!--l. 438--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">b</span>) (<span 
class="cmti-9">pos</span><!--l. 438--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">q</span>) (<!--l. 438--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmti-9">r n</span>))
                                          ((<!--l. 439--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’(<span 
class="cmss-9">0 1</span>) <span 
class="cmti-9">b</span>)
                                           (<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">a ad dd</span>)
                                            (<span 
class="cmti-9">pos</span><!--l. 441--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">dd</span>)
                                            (<!--l. 442--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">a </span>,<span 
class="cmti-9">ad </span>. ,<span 
class="cmti-9">dd</span>) <span 
class="cmti-9">n</span>)
                                            (<span 
class="cmti-9">exp2</span><!--l. 443--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">n </span>’() <span 
class="cmti-9">q</span>)
                                            (<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">s</span>)
                                              (<span 
class="cmti-9">split</span><!--l. 445--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">n dd r s</span>))))
                                          ((<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">a ad add ddd</span>)
                                            (<span 
class="cmbx-9">cond</span><!--l. 447--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>
                                              ((<!--l. 448--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’(<span 
class="cmss-9">1 1</span>) <span 
class="cmti-9">b</span>))
                                              ((<!--l. 449--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(,<span 
class="cmti-9">a </span>,<span 
class="cmti-9">ad </span>,<span 
class="cmti-9">add </span>. ,<span 
class="cmti-9">ddd</span>) <span 
class="cmti-9">b</span>))))
                                           (<!--l. 450--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">&#x003C;</mo></math><span 
class="cmti-9">l</span><!--l. 450--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">b n</span>)
                                           (<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">bw1 bw nw nw1 ql1 q</span><!--l. 451--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>l</mi></math> <span 
class="cmti-9">s</span>)
                                             (<span 
class="cmti-9">exp2</span><!--l. 452--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">b </span>’() <span 
class="cmti-9">bw1</span>)
                                             (<!--l. 453--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">+</mo></math><!--l. 453--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> <span 
class="cmti-9">bw1 </span>’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">bw</span>)
                                             (<!--l. 454--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">&#x003C;</mo></math><span 
class="cmti-9">l</span><!--l. 454--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">q n</span>)
                                             (<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">q</span><!--l. 455--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">bwq1</span>)
                                               (<!--l. 456--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">+</mo></math><!--l. 456--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> <span 
class="cmti-9">q </span>’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">q</span><!--l. 456--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
>
<mn>1</mn></mrow></msub 
></mrow></msub 
></math>)
                                               (<!--l. 457--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo><mi 
>o</mi></math> <span 
class="cmti-9">bw q</span><!--l. 457--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
>
<mn>1</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">bwq1</span>)
                                               (<!--l. 458--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">&#x003C;</mo><mi 
>o</mi></math> <span 
class="cmti-9">nw1 bwq1</span>))
                                             (<span 
class="cmti-9">exp2</span><!--l. 459--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">n </span>’() <span 
class="cmti-9">nw1</span>)
                                             (<!--l. 460--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">+</mo></math><!--l. 460--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> <span 
class="cmti-9">nw1 </span>’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">nw</span>)
                                             (<!--l. 461--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">÷</mo><mi 
>o</mi></math> <span 
class="cmti-9">nw bw ql1 s</span>)
                                             (<!--l. 462--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">+</mo></math><!--l. 462--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> <span 
class="cmti-9">q</span><!--l. 462--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" >
<mi 
>l</mi></math> ’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">ql1</span>)
                                             (<!--l. 463--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≤</mo></math><span 
class="cmti-9">l</span><!--l. 463--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">q</span><!--l. 463--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" >
<mi 
>l</mi></math> <span 
class="cmti-9">q</span>)
                                             (<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">bql q</span><!--l. 464--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>h</mi></math> <span 
class="cmti-9">s qdh qd</span>)
                                               (<span 
class="cmti-9">repeated-mul</span><!--l. 465--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">b q</span><!--l. 465--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" >
<mi 
>l</mi></math> <span 
class="cmti-9">bql</span>)
                                               (<!--l. 466--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">÷</mo><mi 
>o</mi></math> <span 
class="cmti-9">nw bw1 q</span><!--l. 466--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" >
<mi 
>h</mi></math> <span 
class="cmti-9">s</span>)
                                               (<!--l. 467--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">+</mo></math><!--l. 467--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> <span 
class="cmti-9">q</span><!--l. 467--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" >
<mi 
>l</mi></math> <span 
class="cmti-9">qdh q</span><!--l. 467--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>h</mi></math>)
                                               (<!--l. 468--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">+</mo></math><!--l. 468--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> <span 
class="cmti-9">q</span><!--l. 468--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" >
<mi 
>l</mi></math> <span 
class="cmti-9">qd q</span>)
                                               (<!--l. 469--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≤</mo><mi 
>o</mi></math> <span 
class="cmti-9">qd qdh</span>)
                                               (<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">bqd bq1 bq</span>)
                                                (<span 
class="cmti-9">repeated-mul</span><!--l. 471--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">b qd bqd</span>)
                                                (<!--l. 472--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo><mi 
>o</mi></math> <span 
class="cmti-9">bql bqd bq</span>)
                                                (<!--l. 473--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo><mi 
>o</mi></math> <span 
class="cmti-9">b bq bq1</span>)
                                                (<!--l. 474--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">+</mo></math><!--l. 474--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> <span 
class="cmti-9">bq r n</span>)
                                                (<!--l. 475--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">&#x003C;</mo><mi 
>o</mi></math> <span 
class="cmti-9">n bq1</span>))))))))
                                     (<span 
class="cmbx-9">define </span><span 
class="cmti-9">exp2</span><!--l. 479--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
                                      <span 
class="cmti-9"> </span>(<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">n b q</span>)
                                         (<span 
class="cmbx-9">cond</span><!--l. 481--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi></math>
                                           ((<!--l. 482--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">n</span>) (<!--l. 482--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">q</span>))
                                           ((<!--l. 483--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">&#x003E;</mo> <mspace width="-0.17em" class="negthinspace"/></math><span 
class="cmbx-9">1</span><!--l. 483--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> <span 
class="cmti-9">n</span>) (<!--l. 483--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">q</span>)
                                            (<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">s</span>)
                                             (<span 
class="cmti-9">split</span><!--l. 485--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">n b s </span>’(<span 
class="cmss-9">1</span>))))
                                           ((<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">q</span><!--l. 486--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">b</span><!--l. 486--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow></msub 
></math>)
                                             (<!--l. 487--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">0 </span>. ,<span 
class="cmti-9">q</span><!--l. 487--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>) <span 
class="cmti-9">q</span>)
                                             (<span 
class="cmti-9">pos</span><!--l. 488--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">q</span><!--l. 488--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
>
<mn>1</mn></mrow></msub 
></mrow></msub 
></math>)
                                             (<!--l. 489--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">&#x003C;</mo></math><span 
class="cmti-9">l</span><!--l. 489--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">b n</span>)
                                             (<span 
class="cmti-9">append</span><!--l. 490--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">b </span>‘(<span 
class="cmss-9">1 </span>. ,<span 
class="cmti-9">b</span>) <span 
class="cmti-9">b</span><!--l. 490--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
>
<mn>2</mn></mrow></msub 
></mrow></msub 
></math>)
                                             (<span 
class="cmti-9">exp2</span><!--l. 491--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">n b</span><!--l. 491--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
>
<mn>2</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">q</span><!--l. 491--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>)))
                                           ((<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">q</span><!--l. 492--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">n</span><!--l. 492--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>h</mi></math> <span 
class="cmti-9">b</span><!--l. 492--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">s</span>)
                                             (<!--l. 493--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ‘(<span 
class="cmss-9">1 </span>. ,<span 
class="cmti-9">q</span><!--l. 493--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>) <span 
class="cmti-9">q</span>)
                                             (<span 
class="cmti-9">pos</span><!--l. 494--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">q</span><!--l. 494--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
>
<mn>1</mn></mrow></msub 
></mrow></msub 
></math>)
                                             (<span 
class="cmti-9">pos</span><!--l. 495--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">n</span><!--l. 495--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" >
<mi 
>h</mi></math>)
                                             (<span 
class="cmti-9">split</span><!--l. 496--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">n b s n</span><!--l. 496--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" >
<mi 
>h</mi></math>)
                                             (<span 
class="cmti-9">append</span><!--l. 497--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">b </span>‘(<span 
class="cmss-9">1 </span>. ,<span 
class="cmti-9">b</span>) <span 
class="cmti-9">b</span><!--l. 497--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
>
<mn>2</mn></mrow></msub 
></mrow></msub 
></math>)
                                             (<span 
class="cmti-9">exp2</span><!--l. 498--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">n</span><!--l. 498--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" >
<mi 
>h</mi></math> <span 
class="cmti-9">b</span><!--l. 498--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">q</span><!--l. 498--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math>))))))

(<span 
class="cmbx-9">define </span><span 
class="cmti-9">repeated-mul</span><!--l. 502--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math>
(<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">n q nq</span>)
(<span 
class="cmbx-9">cond</span><!--l. 504--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi> </math>
((<span 
class="cmti-9">pos</span><!--l. 505--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi> </math> <span 
class="cmti-9">n</span>) (<!--l. 505--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’() <span 
class="cmti-9">q</span>) (<!--l. 505--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">nq</span>))
((<!--l. 506--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math> ’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">q</span>) (<!--l. 506--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">≡</mo></math><span 
class="cmti-9">n nq</span>))
((<!--l. 507--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel" stretchy="false">&#x003E;</mo> <mspace width="-0.17em" class="negthinspace"/> </math><span 
class="cmbx-9">1</span><!--l. 507--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> <span 
class="cmti-9">q</span>)
(<span 
class="cmbx-9">fresh </span>(<span 
class="cmti-9">q</span><!--l. 508--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">nq1</span>)
(<!--l. 509--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">+</mo></math><!--l. 509--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>o</mi></math> <span 
class="cmti-9">q</span><!--l. 509--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
>
<mn>1</mn></mrow></msub 
></mrow></msub 
></math> ’(<span 
class="cmss-9">1</span>) <span 
class="cmti-9">q</span>)
(<span 
class="cmti-9">repeated-mul</span><!--l. 510--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mspace width="0.17em" class="thinspace"/><mi 
>o</mi></math> <span 
class="cmti-9">n q</span><!--l. 510--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><msub><mrow 
></mrow><mrow 
>
<mn>1</mn></mrow></msub 
></mrow></msub 
></math> <span 
class="cmti-9">nq1</span>)
(<!--l. 511--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin" stretchy="false">∗</mo><mi 
>o</mi> </math> <span 
class="cmti-9">nq1 n nq</span>))))))
(<span 
class="cmbx-9">define </span><!--l. 515--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>e</mi><mi 
>x</mi><mi 
>p</mi><mi 
>o</mi> </math>
(<span 
class="cmbx-9">lambda </span>(<span 
class="cmti-9">b q n</span>)
(<!--l. 517--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>l</mi><mi 
>o</mi><mi 
>g</mi><mi 
>o</mi> </math> <span 
class="cmti-9">n b q </span>’())))
</p>
{% endblock %}
